/* KeyboardManager.c generated by valac 0.56.17, the Vala compiler
 * generated from KeyboardManager.vala, do not modify */

/*
 * Copyright 2016 Santiago Le√≥n
 * Copyright 2023 elementary, Inc. <https://elementary.io>
 * SPDX-License-Identifier: GPL-3.0-or-later
 */

#include <glib-object.h>
#include <meta/display.h>
#include <stdlib.h>
#include <string.h>
#include <glib.h>
#include <gio/gio.h>
#include <meta/compositor.h>
#include <meta/meta-backend.h>
#include <meta/meta-context.h>

#if !defined(VALA_STRICT_C)
#if !defined(__clang__) && defined(__GNUC__) && (__GNUC__ >= 14)
#pragma GCC diagnostic warning "-Wincompatible-pointer-types"
#elif defined(__clang__) && (__clang_major__ >= 16)
#pragma clang diagnostic ignored "-Wincompatible-function-pointer-types"
#pragma clang diagnostic ignored "-Wincompatible-pointer-types"
#endif
#endif
#if !defined(VALA_EXTERN)
#if defined(_MSC_VER)
#define VALA_EXTERN __declspec(dllexport) extern
#elif __GNUC__ >= 4
#define VALA_EXTERN __attribute__((visibility("default"))) extern
#else
#define VALA_EXTERN extern
#endif
#endif

#define GALA_TYPE_KEYBOARD_MANAGER (gala_keyboard_manager_get_type ())
#define GALA_KEYBOARD_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManager))
#define GALA_KEYBOARD_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManagerClass))
#define GALA_IS_KEYBOARD_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GALA_TYPE_KEYBOARD_MANAGER))
#define GALA_IS_KEYBOARD_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GALA_TYPE_KEYBOARD_MANAGER))
#define GALA_KEYBOARD_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManagerClass))

typedef struct _GalaKeyboardManager GalaKeyboardManager;
typedef struct _GalaKeyboardManagerClass GalaKeyboardManagerClass;
typedef struct _GalaKeyboardManagerPrivate GalaKeyboardManagerPrivate;
enum  {
	GALA_KEYBOARD_MANAGER_0_PROPERTY,
	GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY,
	GALA_KEYBOARD_MANAGER_NUM_PROPERTIES
};
static GParamSpec* gala_keyboard_manager_properties[GALA_KEYBOARD_MANAGER_NUM_PROPERTIES];
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_variant_unref0(var) ((var == NULL) ? NULL : (var = (g_variant_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_variant_type_free0(var) ((var == NULL) ? NULL : (var = (g_variant_type_free (var), NULL)))
#define _g_settings_schema_unref0(var) ((var == NULL) ? NULL : (var = (g_settings_schema_unref (var), NULL)))

struct _GalaKeyboardManager {
	GObject parent_instance;
	GalaKeyboardManagerPrivate * priv;
};

struct _GalaKeyboardManagerClass {
	GObjectClass parent_class;
};

struct _GalaKeyboardManagerPrivate {
	MetaDisplay* _display;
};

static gint GalaKeyboardManager_private_offset;
static gpointer gala_keyboard_manager_parent_class = NULL;
static GalaKeyboardManager* gala_keyboard_manager_instance;
static GalaKeyboardManager* gala_keyboard_manager_instance = NULL;
static GVariantType* gala_keyboard_manager_sources_variant_type;
static GVariantType* gala_keyboard_manager_sources_variant_type = NULL;
static GSettings* gala_keyboard_manager_settings;
static GSettings* gala_keyboard_manager_settings = NULL;

VALA_EXTERN GType gala_keyboard_manager_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (GalaKeyboardManager, g_object_unref)
VALA_EXTERN void gala_keyboard_manager_init (MetaDisplay* display);
static GalaKeyboardManager* gala_keyboard_manager_new (MetaDisplay* display);
static GalaKeyboardManager* gala_keyboard_manager_construct (GType object_type,
                                                      MetaDisplay* display);
static gboolean __lambda145_ (MetaDisplay* display);
VALA_EXTERN gboolean gala_keyboard_manager_handle_modifiers_accelerator_activated (MetaDisplay* display,
                                                                       gboolean backward);
static gboolean ___lambda145__meta_display_modifiers_accelerator_activated (MetaDisplay* _sender,
                                                                     gpointer self);
static void gala_keyboard_manager_set_keyboard_layout (GSettings* settings,
                                                const gchar* key,
                                                GalaKeyboardManager* self);
static void _vala_array_add6 (gchar** * array,
                       gint* length,
                       gint* size,
                       gchar* value);
static void _vala_array_add7 (gchar** * array,
                       gint* length,
                       gint* size,
                       gchar* value);
static gboolean _vala_string_array_contains (const gchar* * stack,
                                      gssize stack_length,
                                      const const gchar* needle);
static void _vala_array_add8 (gchar** * array,
                       gint* length,
                       gint* size,
                       gchar* value);
static MetaDisplay* gala_keyboard_manager_get_display (GalaKeyboardManager* self);
static void gala_keyboard_manager_set_display (GalaKeyboardManager* self,
                                        MetaDisplay* value);
static GObject * gala_keyboard_manager_constructor (GType type,
                                             guint n_construct_properties,
                                             GObjectConstructParam * construct_properties);
static void _gala_keyboard_manager_set_keyboard_layout_g_settings_changed (GSettings* _sender,
                                                                    const gchar* key,
                                                                    gpointer self);
static void gala_keyboard_manager_finalize (GObject * obj);
static GType gala_keyboard_manager_get_type_once (void);
static void _vala_gala_keyboard_manager_get_property (GObject * object,
                                               guint property_id,
                                               GValue * value,
                                               GParamSpec * pspec);
static void _vala_gala_keyboard_manager_set_property (GObject * object,
                                               guint property_id,
                                               const GValue * value,
                                               GParamSpec * pspec);
static void _vala_array_destroy (gpointer array,
                          gssize array_length,
                          GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array,
                       gssize array_length,
                       GDestroyNotify destroy_func);
static gssize _vala_array_length (gpointer array);

static const gchar* GALA_KEYBOARD_MANAGER_BLOCKED_OPTIONS[8] = {"grp:alt_caps_toggle", "grp:alt_shift_toggle", "grp:alt_space_toggle", "grp:shifts_toggle", "grp:caps_toggle", "grp:ctrl_alt_toggle", "grp:ctrl_shift_toggle", "grp:shift_caps_toggle"};

static inline gpointer
gala_keyboard_manager_get_instance_private (GalaKeyboardManager* self)
{
	return G_STRUCT_MEMBER_P (self, GalaKeyboardManager_private_offset);
}

static gboolean
__lambda145_ (MetaDisplay* display)
{
	gboolean result;
#line 27 "../src/KeyboardManager.vala"
	g_return_val_if_fail (display != NULL, FALSE);
#line 27 "../src/KeyboardManager.vala"
	result = gala_keyboard_manager_handle_modifiers_accelerator_activated (display, FALSE);
#line 27 "../src/KeyboardManager.vala"
	return result;
#line 157 "KeyboardManager.c"
}

static gboolean
___lambda145__meta_display_modifiers_accelerator_activated (MetaDisplay* _sender,
                                                            gpointer self)
{
	gboolean result;
	result = __lambda145_ (_sender);
#line 27 "../src/KeyboardManager.vala"
	return result;
#line 168 "KeyboardManager.c"
}

void
gala_keyboard_manager_init (MetaDisplay* display)
{
	GalaKeyboardManager* _tmp0_;
	GalaKeyboardManager* _tmp1_;
#line 20 "../src/KeyboardManager.vala"
	g_return_if_fail (display != NULL);
#line 21 "../src/KeyboardManager.vala"
	_tmp0_ = gala_keyboard_manager_instance;
#line 21 "../src/KeyboardManager.vala"
	if (_tmp0_ != NULL) {
#line 22 "../src/KeyboardManager.vala"
		return;
#line 184 "KeyboardManager.c"
	}
#line 25 "../src/KeyboardManager.vala"
	_tmp1_ = gala_keyboard_manager_new (display);
#line 25 "../src/KeyboardManager.vala"
	_g_object_unref0 (gala_keyboard_manager_instance);
#line 25 "../src/KeyboardManager.vala"
	gala_keyboard_manager_instance = _tmp1_;
#line 27 "../src/KeyboardManager.vala"
	g_signal_connect (display, "modifiers-accelerator-activated", (GCallback) ___lambda145__meta_display_modifiers_accelerator_activated, NULL);
#line 194 "KeyboardManager.c"
}

static GalaKeyboardManager*
gala_keyboard_manager_construct (GType object_type,
                                 MetaDisplay* display)
{
	GalaKeyboardManager * self = NULL;
#line 48 "../src/KeyboardManager.vala"
	g_return_val_if_fail (display != NULL, NULL);
#line 49 "../src/KeyboardManager.vala"
	self = (GalaKeyboardManager*) g_object_new (object_type, "display", display, NULL);
#line 48 "../src/KeyboardManager.vala"
	return self;
#line 208 "KeyboardManager.c"
}

static GalaKeyboardManager*
gala_keyboard_manager_new (MetaDisplay* display)
{
#line 48 "../src/KeyboardManager.vala"
	return gala_keyboard_manager_construct (GALA_TYPE_KEYBOARD_MANAGER, display);
#line 216 "KeyboardManager.c"
}

gboolean
gala_keyboard_manager_handle_modifiers_accelerator_activated (MetaDisplay* display,
                                                              gboolean backward)
{
	MetaCompositor* _tmp0_;
	MetaBackend* _tmp1_;
	MetaBackend* _tmp2_;
	MetaBackend* _tmp3_;
	GVariant* sources = NULL;
	GSettings* _tmp4_;
	GVariant* _tmp5_;
	GVariant* _tmp6_;
	const GVariantType* _tmp7_;
	guint n_sources = 0U;
	GVariant* _tmp8_;
	guint current = 0U;
	GSettings* _tmp9_;
	gboolean result;
#line 53 "../src/KeyboardManager.vala"
	g_return_val_if_fail (display != NULL, FALSE);
#line 55 "../src/KeyboardManager.vala"
	_tmp0_ = meta_display_get_compositor (display);
#line 55 "../src/KeyboardManager.vala"
	g_object_get (_tmp0_, "backend", &_tmp1_, NULL);
#line 55 "../src/KeyboardManager.vala"
	_tmp2_ = _tmp1_;
#line 55 "../src/KeyboardManager.vala"
	_tmp3_ = _tmp2_;
#line 55 "../src/KeyboardManager.vala"
	meta_backend_ungrab_keyboard (_tmp3_, meta_display_get_current_time (display));
#line 55 "../src/KeyboardManager.vala"
	_g_object_unref0 (_tmp3_);
#line 60 "../src/KeyboardManager.vala"
	_tmp4_ = gala_keyboard_manager_settings;
#line 60 "../src/KeyboardManager.vala"
	_tmp5_ = g_settings_get_value (_tmp4_, "sources");
#line 60 "../src/KeyboardManager.vala"
	sources = _tmp5_;
#line 61 "../src/KeyboardManager.vala"
	_tmp6_ = sources;
#line 61 "../src/KeyboardManager.vala"
	_tmp7_ = gala_keyboard_manager_sources_variant_type;
#line 61 "../src/KeyboardManager.vala"
	if (!g_variant_is_of_type (_tmp6_, _tmp7_)) {
#line 62 "../src/KeyboardManager.vala"
		result = TRUE;
#line 62 "../src/KeyboardManager.vala"
		_g_variant_unref0 (sources);
#line 62 "../src/KeyboardManager.vala"
		return result;
#line 269 "KeyboardManager.c"
	}
#line 65 "../src/KeyboardManager.vala"
	_tmp8_ = sources;
#line 65 "../src/KeyboardManager.vala"
	n_sources = (guint) g_variant_n_children (_tmp8_);
#line 66 "../src/KeyboardManager.vala"
	if (n_sources < ((guint) 2)) {
#line 67 "../src/KeyboardManager.vala"
		result = TRUE;
#line 67 "../src/KeyboardManager.vala"
		_g_variant_unref0 (sources);
#line 67 "../src/KeyboardManager.vala"
		return result;
#line 283 "KeyboardManager.c"
	}
#line 70 "../src/KeyboardManager.vala"
	_tmp9_ = gala_keyboard_manager_settings;
#line 70 "../src/KeyboardManager.vala"
	current = g_settings_get_uint (_tmp9_, "current");
#line 72 "../src/KeyboardManager.vala"
	if (!backward) {
#line 291 "KeyboardManager.c"
		GSettings* _tmp10_;
#line 73 "../src/KeyboardManager.vala"
		_tmp10_ = gala_keyboard_manager_settings;
#line 73 "../src/KeyboardManager.vala"
		g_settings_set_uint (_tmp10_, "current", (current + 1) % n_sources);
#line 297 "KeyboardManager.c"
	} else {
		GSettings* _tmp11_;
#line 75 "../src/KeyboardManager.vala"
		_tmp11_ = gala_keyboard_manager_settings;
#line 75 "../src/KeyboardManager.vala"
		g_settings_set_uint (_tmp11_, "current", (current - 1) % n_sources);
#line 304 "KeyboardManager.c"
	}
#line 78 "../src/KeyboardManager.vala"
	result = TRUE;
#line 78 "../src/KeyboardManager.vala"
	_g_variant_unref0 (sources);
#line 78 "../src/KeyboardManager.vala"
	return result;
#line 312 "KeyboardManager.c"
}

static void
_vala_array_add6 (gchar** * array,
                  gint* length,
                  gint* size,
                  gchar* value)
{
#line 97 "../src/KeyboardManager.vala"
	if ((*length) == (*size)) {
#line 97 "../src/KeyboardManager.vala"
		*size = (*size) ? (2 * (*size)) : 4;
#line 97 "../src/KeyboardManager.vala"
		*array = g_renew (gchar*, *array, (*size) + 1);
#line 327 "KeyboardManager.c"
	}
#line 97 "../src/KeyboardManager.vala"
	(*array)[(*length)++] = value;
#line 97 "../src/KeyboardManager.vala"
	(*array)[*length] = NULL;
#line 333 "KeyboardManager.c"
}

static void
_vala_array_add7 (gchar** * array,
                  gint* length,
                  gint* size,
                  gchar* value)
{
#line 98 "../src/KeyboardManager.vala"
	if ((*length) == (*size)) {
#line 98 "../src/KeyboardManager.vala"
		*size = (*size) ? (2 * (*size)) : 4;
#line 98 "../src/KeyboardManager.vala"
		*array = g_renew (gchar*, *array, (*size) + 1);
#line 348 "KeyboardManager.c"
	}
#line 98 "../src/KeyboardManager.vala"
	(*array)[(*length)++] = value;
#line 98 "../src/KeyboardManager.vala"
	(*array)[*length] = NULL;
#line 354 "KeyboardManager.c"
}

static gboolean
_vala_string_array_contains (const gchar* * stack,
                             gssize stack_length,
                             const const gchar* needle)
{
	gssize i;
#line 111 "../src/KeyboardManager.vala"
	for (i = 0; i < stack_length; i++) {
#line 111 "../src/KeyboardManager.vala"
		if (g_strcmp0 (stack[i], needle) == 0) {
#line 111 "../src/KeyboardManager.vala"
			return TRUE;
#line 369 "KeyboardManager.c"
		}
	}
#line 111 "../src/KeyboardManager.vala"
	return FALSE;
#line 374 "KeyboardManager.c"
}

static void
_vala_array_add8 (gchar** * array,
                  gint* length,
                  gint* size,
                  gchar* value)
{
#line 112 "../src/KeyboardManager.vala"
	if ((*length) == (*size)) {
#line 112 "../src/KeyboardManager.vala"
		*size = (*size) ? (2 * (*size)) : 4;
#line 112 "../src/KeyboardManager.vala"
		*array = g_renew (gchar*, *array, (*size) + 1);
#line 389 "KeyboardManager.c"
	}
#line 112 "../src/KeyboardManager.vala"
	(*array)[(*length)++] = value;
#line 112 "../src/KeyboardManager.vala"
	(*array)[*length] = NULL;
#line 395 "KeyboardManager.c"
}

static gchar*
_vala_g_strjoinv (const gchar* separator,
                  gchar** str_array,
                  gint str_array_length1)
{
	gboolean _tmp0_ = FALSE;
	gchar* result;
#line 1251 "glib-2.0.vapi"
	if (separator == NULL) {
#line 1252 "glib-2.0.vapi"
		separator = "";
#line 409 "KeyboardManager.c"
	}
#line 1254 "glib-2.0.vapi"
	if (str_array != NULL) {
#line 413 "KeyboardManager.c"
		gboolean _tmp1_ = FALSE;
#line 1254 "glib-2.0.vapi"
		if (str_array_length1 > 0) {
#line 1254 "glib-2.0.vapi"
			_tmp1_ = TRUE;
#line 419 "KeyboardManager.c"
		} else {
			gboolean _tmp2_ = FALSE;
#line 1254 "glib-2.0.vapi"
			if (str_array_length1 == -1) {
#line 424 "KeyboardManager.c"
				const gchar* _tmp3_;
#line 1254 "glib-2.0.vapi"
				_tmp3_ = str_array[0];
#line 1254 "glib-2.0.vapi"
				_tmp2_ = _tmp3_ != NULL;
#line 430 "KeyboardManager.c"
			} else {
#line 1254 "glib-2.0.vapi"
				_tmp2_ = FALSE;
#line 434 "KeyboardManager.c"
			}
#line 1254 "glib-2.0.vapi"
			_tmp1_ = _tmp2_;
#line 438 "KeyboardManager.c"
		}
#line 1254 "glib-2.0.vapi"
		_tmp0_ = _tmp1_;
#line 442 "KeyboardManager.c"
	} else {
#line 1254 "glib-2.0.vapi"
		_tmp0_ = FALSE;
#line 446 "KeyboardManager.c"
	}
#line 1254 "glib-2.0.vapi"
	if (_tmp0_) {
#line 450 "KeyboardManager.c"
		gint i = 0;
		gsize len = 0UL;
		gint _tmp16_;
		gint _tmp17_;
		const gchar* res = NULL;
		void* _tmp18_;
		const gchar* _tmp19_ = NULL;
		const gchar* _tmp20_;
		void* ptr = NULL;
		const gchar* _tmp22_;
		void* _tmp23_;
		const gchar* _tmp33_;
#line 1256 "glib-2.0.vapi"
		len = (gsize) 1;
#line 465 "KeyboardManager.c"
		{
			gboolean _tmp4_ = FALSE;
#line 1257 "glib-2.0.vapi"
			i = 0;
#line 1257 "glib-2.0.vapi"
			_tmp4_ = TRUE;
#line 1257 "glib-2.0.vapi"
			while (TRUE) {
#line 474 "KeyboardManager.c"
				gboolean _tmp6_ = FALSE;
				gboolean _tmp7_ = FALSE;
				gint _tmp10_ = 0;
				const gchar* _tmp11_;
#line 1257 "glib-2.0.vapi"
				if (!_tmp4_) {
#line 481 "KeyboardManager.c"
					gint _tmp5_;
#line 1257 "glib-2.0.vapi"
					_tmp5_ = i;
#line 1257 "glib-2.0.vapi"
					i = _tmp5_ + 1;
#line 487 "KeyboardManager.c"
				}
#line 1257 "glib-2.0.vapi"
				_tmp4_ = FALSE;
#line 1257 "glib-2.0.vapi"
				if (str_array_length1 != -1) {
#line 1257 "glib-2.0.vapi"
					_tmp7_ = i < str_array_length1;
#line 495 "KeyboardManager.c"
				} else {
#line 1257 "glib-2.0.vapi"
					_tmp7_ = FALSE;
#line 499 "KeyboardManager.c"
				}
#line 1257 "glib-2.0.vapi"
				if (_tmp7_) {
#line 1257 "glib-2.0.vapi"
					_tmp6_ = TRUE;
#line 505 "KeyboardManager.c"
				} else {
					gboolean _tmp8_ = FALSE;
#line 1257 "glib-2.0.vapi"
					if (str_array_length1 == -1) {
#line 510 "KeyboardManager.c"
						const gchar* _tmp9_;
#line 1257 "glib-2.0.vapi"
						_tmp9_ = str_array[i];
#line 1257 "glib-2.0.vapi"
						_tmp8_ = _tmp9_ != NULL;
#line 516 "KeyboardManager.c"
					} else {
#line 1257 "glib-2.0.vapi"
						_tmp8_ = FALSE;
#line 520 "KeyboardManager.c"
					}
#line 1257 "glib-2.0.vapi"
					_tmp6_ = _tmp8_;
#line 524 "KeyboardManager.c"
				}
#line 1257 "glib-2.0.vapi"
				if (!_tmp6_) {
#line 1257 "glib-2.0.vapi"
					break;
#line 530 "KeyboardManager.c"
				}
#line 1258 "glib-2.0.vapi"
				_tmp11_ = str_array[i];
#line 1258 "glib-2.0.vapi"
				if (_tmp11_ != NULL) {
#line 536 "KeyboardManager.c"
					const gchar* _tmp12_;
					gint _tmp13_;
					gint _tmp14_;
#line 1258 "glib-2.0.vapi"
					_tmp12_ = str_array[i];
#line 1258 "glib-2.0.vapi"
					_tmp13_ = strlen ((const gchar*) _tmp12_);
#line 1258 "glib-2.0.vapi"
					_tmp14_ = _tmp13_;
#line 1258 "glib-2.0.vapi"
					_tmp10_ = _tmp14_;
#line 548 "KeyboardManager.c"
				} else {
#line 1258 "glib-2.0.vapi"
					_tmp10_ = 0;
#line 552 "KeyboardManager.c"
				}
#line 1258 "glib-2.0.vapi"
				len += (gsize) _tmp10_;
#line 556 "KeyboardManager.c"
			}
		}
#line 1260 "glib-2.0.vapi"
		if (i == 0) {
#line 561 "KeyboardManager.c"
			gchar* _tmp15_;
#line 1261 "glib-2.0.vapi"
			_tmp15_ = g_strdup ("");
#line 1261 "glib-2.0.vapi"
			result = _tmp15_;
#line 1261 "glib-2.0.vapi"
			return result;
#line 569 "KeyboardManager.c"
		}
#line 1263 "glib-2.0.vapi"
		str_array_length1 = i;
#line 1264 "glib-2.0.vapi"
		_tmp16_ = strlen ((const gchar*) separator);
#line 1264 "glib-2.0.vapi"
		_tmp17_ = _tmp16_;
#line 1264 "glib-2.0.vapi"
		len += (gsize) (_tmp17_ * (i - 1));
#line 1266 "glib-2.0.vapi"
		_tmp18_ = g_malloc (len);
#line 1266 "glib-2.0.vapi"
		res = _tmp18_;
#line 1267 "glib-2.0.vapi"
		_tmp20_ = str_array[0];
#line 1267 "glib-2.0.vapi"
		if (_tmp20_ != NULL) {
#line 587 "KeyboardManager.c"
			const gchar* _tmp21_;
#line 1267 "glib-2.0.vapi"
			_tmp21_ = str_array[0];
#line 1267 "glib-2.0.vapi"
			_tmp19_ = (const gchar*) _tmp21_;
#line 593 "KeyboardManager.c"
		} else {
#line 1267 "glib-2.0.vapi"
			_tmp19_ = "";
#line 597 "KeyboardManager.c"
		}
#line 1267 "glib-2.0.vapi"
		_tmp22_ = res;
#line 1267 "glib-2.0.vapi"
		_tmp23_ = g_stpcpy ((void*) _tmp22_, _tmp19_);
#line 1267 "glib-2.0.vapi"
		ptr = _tmp23_;
#line 605 "KeyboardManager.c"
		{
			gboolean _tmp24_ = FALSE;
#line 1268 "glib-2.0.vapi"
			i = 1;
#line 1268 "glib-2.0.vapi"
			_tmp24_ = TRUE;
#line 1268 "glib-2.0.vapi"
			while (TRUE) {
#line 614 "KeyboardManager.c"
				void* _tmp26_;
				void* _tmp27_;
				const gchar* _tmp28_ = NULL;
				const gchar* _tmp29_;
				void* _tmp31_;
				void* _tmp32_;
#line 1268 "glib-2.0.vapi"
				if (!_tmp24_) {
#line 623 "KeyboardManager.c"
					gint _tmp25_;
#line 1268 "glib-2.0.vapi"
					_tmp25_ = i;
#line 1268 "glib-2.0.vapi"
					i = _tmp25_ + 1;
#line 629 "KeyboardManager.c"
				}
#line 1268 "glib-2.0.vapi"
				_tmp24_ = FALSE;
#line 1268 "glib-2.0.vapi"
				if (!(i < str_array_length1)) {
#line 1268 "glib-2.0.vapi"
					break;
#line 637 "KeyboardManager.c"
				}
#line 1269 "glib-2.0.vapi"
				_tmp26_ = ptr;
#line 1269 "glib-2.0.vapi"
				_tmp27_ = g_stpcpy (_tmp26_, (const gchar*) separator);
#line 1269 "glib-2.0.vapi"
				ptr = _tmp27_;
#line 1270 "glib-2.0.vapi"
				_tmp29_ = str_array[i];
#line 1270 "glib-2.0.vapi"
				if (_tmp29_ != NULL) {
#line 649 "KeyboardManager.c"
					const gchar* _tmp30_;
#line 1270 "glib-2.0.vapi"
					_tmp30_ = str_array[i];
#line 1270 "glib-2.0.vapi"
					_tmp28_ = (const gchar*) _tmp30_;
#line 655 "KeyboardManager.c"
				} else {
#line 1270 "glib-2.0.vapi"
					_tmp28_ = "";
#line 659 "KeyboardManager.c"
				}
#line 1270 "glib-2.0.vapi"
				_tmp31_ = ptr;
#line 1270 "glib-2.0.vapi"
				_tmp32_ = g_stpcpy (_tmp31_, _tmp28_);
#line 1270 "glib-2.0.vapi"
				ptr = _tmp32_;
#line 667 "KeyboardManager.c"
			}
		}
#line 1273 "glib-2.0.vapi"
		_tmp33_ = res;
#line 1273 "glib-2.0.vapi"
		res = NULL;
#line 1273 "glib-2.0.vapi"
		result = (gchar*) _tmp33_;
#line 1273 "glib-2.0.vapi"
		return result;
#line 678 "KeyboardManager.c"
	} else {
		gchar* _tmp34_;
#line 1275 "glib-2.0.vapi"
		_tmp34_ = g_strdup ("");
#line 1275 "glib-2.0.vapi"
		result = _tmp34_;
#line 1275 "glib-2.0.vapi"
		return result;
#line 687 "KeyboardManager.c"
	}
}

static void
gala_keyboard_manager_set_keyboard_layout (GSettings* settings,
                                           const gchar* key,
                                           GalaKeyboardManager* self)
{
	gboolean _tmp0_ = FALSE;
#line 82 "../src/KeyboardManager.vala"
	g_return_if_fail (self != NULL);
#line 82 "../src/KeyboardManager.vala"
	g_return_if_fail (settings != NULL);
#line 82 "../src/KeyboardManager.vala"
	g_return_if_fail (key != NULL);
#line 83 "../src/KeyboardManager.vala"
	if (g_strcmp0 (key, "sources") == 0) {
#line 83 "../src/KeyboardManager.vala"
		_tmp0_ = TRUE;
#line 707 "KeyboardManager.c"
	} else {
#line 83 "../src/KeyboardManager.vala"
		_tmp0_ = g_strcmp0 (key, "xkb-options") == 0;
#line 711 "KeyboardManager.c"
	}
#line 83 "../src/KeyboardManager.vala"
	if (_tmp0_) {
#line 715 "KeyboardManager.c"
		gchar** layouts = NULL;
		gchar** _tmp1_;
		gint layouts_length1;
		gint _layouts_size_;
		gchar** variants = NULL;
		gchar** _tmp2_;
		gint variants_length1;
		gint _variants_size_;
		GVariant* sources = NULL;
		GVariant* _tmp3_;
		GVariant* _tmp4_;
		const GVariantType* _tmp5_;
		gchar** _tmp23_;
		gint _tmp23__length1;
		gchar** xkb_options = NULL;
		gchar** _tmp28_;
		gint xkb_options_length1;
		gint _xkb_options_size_;
		gchar** _tmp29_;
		gint _tmp29__length1;
		gchar* layout = NULL;
		gchar** _tmp37_;
		gint _tmp37__length1;
		gchar* _tmp38_;
		gchar* variant = NULL;
		gchar** _tmp39_;
		gint _tmp39__length1;
		gchar* _tmp40_;
		gchar* options = NULL;
		gchar** _tmp41_;
		gint _tmp41__length1;
		gchar* _tmp42_;
		MetaDisplay* _tmp43_;
		MetaContext* _tmp44_;
		MetaBackend* _tmp45_;
		const gchar* _tmp46_;
		const gchar* _tmp47_;
		const gchar* _tmp48_;
#line 84 "../src/KeyboardManager.vala"
		_tmp1_ = g_new0 (gchar*, 0 + 1);
#line 84 "../src/KeyboardManager.vala"
		layouts = _tmp1_;
#line 84 "../src/KeyboardManager.vala"
		layouts_length1 = 0;
#line 84 "../src/KeyboardManager.vala"
		_layouts_size_ = layouts_length1;
#line 84 "../src/KeyboardManager.vala"
		_tmp2_ = g_new0 (gchar*, 0 + 1);
#line 84 "../src/KeyboardManager.vala"
		variants = _tmp2_;
#line 84 "../src/KeyboardManager.vala"
		variants_length1 = 0;
#line 84 "../src/KeyboardManager.vala"
		_variants_size_ = variants_length1;
#line 86 "../src/KeyboardManager.vala"
		_tmp3_ = g_settings_get_value (settings, "sources");
#line 86 "../src/KeyboardManager.vala"
		sources = _tmp3_;
#line 87 "../src/KeyboardManager.vala"
		_tmp4_ = sources;
#line 87 "../src/KeyboardManager.vala"
		_tmp5_ = gala_keyboard_manager_sources_variant_type;
#line 87 "../src/KeyboardManager.vala"
		if (!g_variant_is_of_type (_tmp4_, _tmp5_)) {
#line 88 "../src/KeyboardManager.vala"
			_g_variant_unref0 (sources);
#line 88 "../src/KeyboardManager.vala"
			variants = (_vala_array_free (variants, variants_length1, (GDestroyNotify) g_free), NULL);
#line 88 "../src/KeyboardManager.vala"
			layouts = (_vala_array_free (layouts, layouts_length1, (GDestroyNotify) g_free), NULL);
#line 88 "../src/KeyboardManager.vala"
			return;
#line 788 "KeyboardManager.c"
		}
		{
			gint i = 0;
#line 91 "../src/KeyboardManager.vala"
			i = 0;
#line 794 "KeyboardManager.c"
			{
				gboolean _tmp6_ = FALSE;
#line 91 "../src/KeyboardManager.vala"
				_tmp6_ = TRUE;
#line 91 "../src/KeyboardManager.vala"
				while (TRUE) {
#line 801 "KeyboardManager.c"
					GVariant* _tmp8_;
					const gchar* type = NULL;
					const gchar* name = NULL;
					GVariant* _tmp9_;
					const gchar* _tmp10_ = NULL;
					const gchar* _tmp11_ = NULL;
					const gchar* _tmp12_;
#line 91 "../src/KeyboardManager.vala"
					if (!_tmp6_) {
#line 811 "KeyboardManager.c"
						gint _tmp7_;
#line 91 "../src/KeyboardManager.vala"
						_tmp7_ = i;
#line 91 "../src/KeyboardManager.vala"
						i = _tmp7_ + 1;
#line 817 "KeyboardManager.c"
					}
#line 91 "../src/KeyboardManager.vala"
					_tmp6_ = FALSE;
#line 91 "../src/KeyboardManager.vala"
					_tmp8_ = sources;
#line 91 "../src/KeyboardManager.vala"
					if (!(((gsize) i) < g_variant_n_children (_tmp8_))) {
#line 91 "../src/KeyboardManager.vala"
						break;
#line 827 "KeyboardManager.c"
					}
#line 92 "../src/KeyboardManager.vala"
					type = NULL;
#line 92 "../src/KeyboardManager.vala"
					name = NULL;
#line 93 "../src/KeyboardManager.vala"
					_tmp9_ = sources;
#line 93 "../src/KeyboardManager.vala"
					g_variant_get_child (_tmp9_, (gsize) i, "(&s&s)", &_tmp10_, &_tmp11_, NULL);
#line 93 "../src/KeyboardManager.vala"
					type = _tmp10_;
#line 93 "../src/KeyboardManager.vala"
					name = _tmp11_;
#line 95 "../src/KeyboardManager.vala"
					_tmp12_ = type;
#line 95 "../src/KeyboardManager.vala"
					if (g_strcmp0 (_tmp12_, "xkb") == 0) {
#line 845 "KeyboardManager.c"
						gchar** arr = NULL;
						const gchar* _tmp13_;
						gchar** _tmp14_;
						gchar** _tmp15_;
						gint arr_length1;
						gint _arr_size_;
						gchar** _tmp16_;
						gint _tmp16__length1;
						const gchar* _tmp17_;
						gchar* _tmp18_;
						const gchar* _tmp19_ = NULL;
						gchar** _tmp20_;
						gint _tmp20__length1;
						const gchar* _tmp21_;
						gchar* _tmp22_;
#line 96 "../src/KeyboardManager.vala"
						_tmp13_ = name;
#line 96 "../src/KeyboardManager.vala"
						_tmp15_ = _tmp14_ = g_strsplit (_tmp13_, "+", 2);
#line 96 "../src/KeyboardManager.vala"
						arr = _tmp15_;
#line 96 "../src/KeyboardManager.vala"
						arr_length1 = _vala_array_length (_tmp14_);
#line 96 "../src/KeyboardManager.vala"
						_arr_size_ = arr_length1;
#line 97 "../src/KeyboardManager.vala"
						_tmp16_ = arr;
#line 97 "../src/KeyboardManager.vala"
						_tmp16__length1 = arr_length1;
#line 97 "../src/KeyboardManager.vala"
						_tmp17_ = _tmp16_[0];
#line 97 "../src/KeyboardManager.vala"
						_tmp18_ = g_strdup (_tmp17_);
#line 97 "../src/KeyboardManager.vala"
						_vala_array_add6 (&layouts, &layouts_length1, &_layouts_size_, _tmp18_);
#line 98 "../src/KeyboardManager.vala"
						_tmp20_ = arr;
#line 98 "../src/KeyboardManager.vala"
						_tmp20__length1 = arr_length1;
#line 98 "../src/KeyboardManager.vala"
						_tmp21_ = _tmp20_[1];
#line 98 "../src/KeyboardManager.vala"
						_tmp19_ = _tmp21_;
#line 98 "../src/KeyboardManager.vala"
						if (_tmp19_ == NULL) {
#line 98 "../src/KeyboardManager.vala"
							_tmp19_ = "";
#line 893 "KeyboardManager.c"
						}
#line 98 "../src/KeyboardManager.vala"
						_tmp22_ = g_strdup (_tmp19_);
#line 98 "../src/KeyboardManager.vala"
						_vala_array_add7 (&variants, &variants_length1, &_variants_size_, _tmp22_);
#line 95 "../src/KeyboardManager.vala"
						arr = (_vala_array_free (arr, arr_length1, (GDestroyNotify) g_free), NULL);
#line 901 "KeyboardManager.c"
					}
				}
			}
		}
#line 103 "../src/KeyboardManager.vala"
		_tmp23_ = layouts;
#line 103 "../src/KeyboardManager.vala"
		_tmp23__length1 = layouts_length1;
#line 103 "../src/KeyboardManager.vala"
		if (_tmp23__length1 == 0) {
#line 912 "KeyboardManager.c"
			gchar* _tmp24_;
			gchar** _tmp25_;
			gchar* _tmp26_;
			gchar** _tmp27_;
#line 104 "../src/KeyboardManager.vala"
			_tmp24_ = g_strdup ("us");
#line 104 "../src/KeyboardManager.vala"
			_tmp25_ = g_new0 (gchar*, 1 + 1);
#line 104 "../src/KeyboardManager.vala"
			_tmp25_[0] = _tmp24_;
#line 104 "../src/KeyboardManager.vala"
			layouts = (_vala_array_free (layouts, layouts_length1, (GDestroyNotify) g_free), NULL);
#line 104 "../src/KeyboardManager.vala"
			layouts = _tmp25_;
#line 104 "../src/KeyboardManager.vala"
			layouts_length1 = 1;
#line 104 "../src/KeyboardManager.vala"
			_layouts_size_ = layouts_length1;
#line 105 "../src/KeyboardManager.vala"
			_tmp26_ = g_strdup ("");
#line 105 "../src/KeyboardManager.vala"
			_tmp27_ = g_new0 (gchar*, 1 + 1);
#line 105 "../src/KeyboardManager.vala"
			_tmp27_[0] = _tmp26_;
#line 105 "../src/KeyboardManager.vala"
			variants = (_vala_array_free (variants, variants_length1, (GDestroyNotify) g_free), NULL);
#line 105 "../src/KeyboardManager.vala"
			variants = _tmp27_;
#line 105 "../src/KeyboardManager.vala"
			variants_length1 = 1;
#line 105 "../src/KeyboardManager.vala"
			_variants_size_ = variants_length1;
#line 945 "KeyboardManager.c"
		}
#line 108 "../src/KeyboardManager.vala"
		_tmp28_ = g_new0 (gchar*, 0 + 1);
#line 108 "../src/KeyboardManager.vala"
		xkb_options = _tmp28_;
#line 108 "../src/KeyboardManager.vala"
		xkb_options_length1 = 0;
#line 108 "../src/KeyboardManager.vala"
		_xkb_options_size_ = xkb_options_length1;
#line 109 "../src/KeyboardManager.vala"
		_tmp29_ = layouts;
#line 109 "../src/KeyboardManager.vala"
		_tmp29__length1 = layouts_length1;
#line 109 "../src/KeyboardManager.vala"
		if (_tmp29__length1 == 1) {
#line 961 "KeyboardManager.c"
			gchar** _tmp30_;
			gchar** _tmp31_;
#line 110 "../src/KeyboardManager.vala"
			_tmp31_ = _tmp30_ = g_settings_get_strv (settings, "xkb-options");
#line 966 "KeyboardManager.c"
			{
				gchar** option_collection = NULL;
				gint option_collection_length1 = 0;
				gint _option_collection_size_ = 0;
				gint option_it = 0;
#line 110 "../src/KeyboardManager.vala"
				option_collection = _tmp31_;
#line 110 "../src/KeyboardManager.vala"
				option_collection_length1 = _vala_array_length (_tmp30_);
#line 110 "../src/KeyboardManager.vala"
				for (option_it = 0; option_it < option_collection_length1; option_it = option_it + 1) {
#line 978 "KeyboardManager.c"
					const gchar* option = NULL;
#line 110 "../src/KeyboardManager.vala"
					option = option_collection[option_it];
#line 982 "KeyboardManager.c"
					{
						const gchar* _tmp32_;
#line 111 "../src/KeyboardManager.vala"
						_tmp32_ = option;
#line 111 "../src/KeyboardManager.vala"
						if (!_vala_string_array_contains (GALA_KEYBOARD_MANAGER_BLOCKED_OPTIONS, G_N_ELEMENTS (GALA_KEYBOARD_MANAGER_BLOCKED_OPTIONS), _tmp32_)) {
#line 989 "KeyboardManager.c"
							const gchar* _tmp33_;
							gchar* _tmp34_;
#line 112 "../src/KeyboardManager.vala"
							_tmp33_ = option;
#line 112 "../src/KeyboardManager.vala"
							_tmp34_ = g_strdup (_tmp33_);
#line 112 "../src/KeyboardManager.vala"
							_vala_array_add8 (&xkb_options, &xkb_options_length1, &_xkb_options_size_, _tmp34_);
#line 998 "KeyboardManager.c"
						}
					}
				}
#line 110 "../src/KeyboardManager.vala"
				option_collection = (_vala_array_free (option_collection, option_collection_length1, (GDestroyNotify) g_free), NULL);
#line 1004 "KeyboardManager.c"
			}
		} else {
			gchar** _tmp35_;
			gchar** _tmp36_;
#line 116 "../src/KeyboardManager.vala"
			_tmp36_ = _tmp35_ = g_settings_get_strv (settings, "xkb-options");
#line 116 "../src/KeyboardManager.vala"
			xkb_options = (_vala_array_free (xkb_options, xkb_options_length1, (GDestroyNotify) g_free), NULL);
#line 116 "../src/KeyboardManager.vala"
			xkb_options = _tmp36_;
#line 116 "../src/KeyboardManager.vala"
			xkb_options_length1 = _vala_array_length (_tmp35_);
#line 116 "../src/KeyboardManager.vala"
			_xkb_options_size_ = xkb_options_length1;
#line 1019 "KeyboardManager.c"
		}
#line 119 "../src/KeyboardManager.vala"
		_tmp37_ = layouts;
#line 119 "../src/KeyboardManager.vala"
		_tmp37__length1 = layouts_length1;
#line 119 "../src/KeyboardManager.vala"
		_tmp38_ = _vala_g_strjoinv (",", _tmp37_, (gint) _tmp37__length1);
#line 119 "../src/KeyboardManager.vala"
		layout = _tmp38_;
#line 120 "../src/KeyboardManager.vala"
		_tmp39_ = variants;
#line 120 "../src/KeyboardManager.vala"
		_tmp39__length1 = variants_length1;
#line 120 "../src/KeyboardManager.vala"
		_tmp40_ = _vala_g_strjoinv (",", _tmp39_, (gint) _tmp39__length1);
#line 120 "../src/KeyboardManager.vala"
		variant = _tmp40_;
#line 121 "../src/KeyboardManager.vala"
		_tmp41_ = xkb_options;
#line 121 "../src/KeyboardManager.vala"
		_tmp41__length1 = xkb_options_length1;
#line 121 "../src/KeyboardManager.vala"
		_tmp42_ = _vala_g_strjoinv (",", _tmp41_, (gint) _tmp41__length1);
#line 121 "../src/KeyboardManager.vala"
		options = _tmp42_;
#line 125 "../src/KeyboardManager.vala"
		_tmp43_ = self->priv->_display;
#line 125 "../src/KeyboardManager.vala"
		_tmp44_ = meta_display_get_context (_tmp43_);
#line 125 "../src/KeyboardManager.vala"
		_tmp45_ = meta_context_get_backend (_tmp44_);
#line 125 "../src/KeyboardManager.vala"
		_tmp46_ = layout;
#line 125 "../src/KeyboardManager.vala"
		_tmp47_ = variant;
#line 125 "../src/KeyboardManager.vala"
		_tmp48_ = options;
#line 125 "../src/KeyboardManager.vala"
		meta_backend_set_keymap (_tmp45_, _tmp46_, _tmp47_, _tmp48_, "");
#line 83 "../src/KeyboardManager.vala"
		_g_free0 (options);
#line 83 "../src/KeyboardManager.vala"
		_g_free0 (variant);
#line 83 "../src/KeyboardManager.vala"
		_g_free0 (layout);
#line 83 "../src/KeyboardManager.vala"
		xkb_options = (_vala_array_free (xkb_options, xkb_options_length1, (GDestroyNotify) g_free), NULL);
#line 83 "../src/KeyboardManager.vala"
		_g_variant_unref0 (sources);
#line 83 "../src/KeyboardManager.vala"
		variants = (_vala_array_free (variants, variants_length1, (GDestroyNotify) g_free), NULL);
#line 83 "../src/KeyboardManager.vala"
		layouts = (_vala_array_free (layouts, layouts_length1, (GDestroyNotify) g_free), NULL);
#line 1073 "KeyboardManager.c"
	} else {
#line 129 "../src/KeyboardManager.vala"
		if (g_strcmp0 (key, "current") == 0) {
#line 1077 "KeyboardManager.c"
			MetaDisplay* _tmp49_;
			MetaContext* _tmp50_;
			MetaBackend* _tmp51_;
#line 130 "../src/KeyboardManager.vala"
			_tmp49_ = self->priv->_display;
#line 130 "../src/KeyboardManager.vala"
			_tmp50_ = meta_display_get_context (_tmp49_);
#line 130 "../src/KeyboardManager.vala"
			_tmp51_ = meta_context_get_backend (_tmp50_);
#line 130 "../src/KeyboardManager.vala"
			meta_backend_lock_layout_group (_tmp51_, g_settings_get_uint (settings, "current"));
#line 1089 "KeyboardManager.c"
		}
	}
}

static MetaDisplay*
gala_keyboard_manager_get_display (GalaKeyboardManager* self)
{
	MetaDisplay* result;
	MetaDisplay* _tmp0_;
#line 18 "../src/KeyboardManager.vala"
	g_return_val_if_fail (self != NULL, NULL);
#line 18 "../src/KeyboardManager.vala"
	_tmp0_ = self->priv->_display;
#line 18 "../src/KeyboardManager.vala"
	result = _tmp0_;
#line 18 "../src/KeyboardManager.vala"
	return result;
#line 1107 "KeyboardManager.c"
}

static void
gala_keyboard_manager_set_display (GalaKeyboardManager* self,
                                   MetaDisplay* value)
{
	MetaDisplay* old_value;
#line 18 "../src/KeyboardManager.vala"
	g_return_if_fail (self != NULL);
#line 18 "../src/KeyboardManager.vala"
	old_value = gala_keyboard_manager_get_display (self);
#line 18 "../src/KeyboardManager.vala"
	if (old_value != value) {
#line 18 "../src/KeyboardManager.vala"
		self->priv->_display = value;
#line 18 "../src/KeyboardManager.vala"
		g_object_notify_by_pspec ((GObject *) self, gala_keyboard_manager_properties[GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY]);
#line 1125 "KeyboardManager.c"
	}
}

static void
_gala_keyboard_manager_set_keyboard_layout_g_settings_changed (GSettings* _sender,
                                                               const gchar* key,
                                                               gpointer self)
{
#line 42 "../src/KeyboardManager.vala"
	gala_keyboard_manager_set_keyboard_layout (_sender, key, (GalaKeyboardManager*) self);
#line 1136 "KeyboardManager.c"
}

static GObject *
gala_keyboard_manager_constructor (GType type,
                                   guint n_construct_properties,
                                   GObjectConstructParam * construct_properties)
{
	GObject * obj;
	GObjectClass * parent_class;
	GalaKeyboardManager * self;
	GSettings* _tmp0_;
	GSettings* _tmp1_;
	GSettings* _tmp2_;
#line 41 "../src/KeyboardManager.vala"
	parent_class = G_OBJECT_CLASS (gala_keyboard_manager_parent_class);
#line 41 "../src/KeyboardManager.vala"
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
#line 41 "../src/KeyboardManager.vala"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManager);
#line 42 "../src/KeyboardManager.vala"
	_tmp0_ = gala_keyboard_manager_settings;
#line 42 "../src/KeyboardManager.vala"
	g_signal_connect_object (_tmp0_, "changed", (GCallback) _gala_keyboard_manager_set_keyboard_layout_g_settings_changed, self, 0);
#line 44 "../src/KeyboardManager.vala"
	_tmp1_ = gala_keyboard_manager_settings;
#line 44 "../src/KeyboardManager.vala"
	gala_keyboard_manager_set_keyboard_layout (_tmp1_, "sources", self);
#line 45 "../src/KeyboardManager.vala"
	_tmp2_ = gala_keyboard_manager_settings;
#line 45 "../src/KeyboardManager.vala"
	gala_keyboard_manager_set_keyboard_layout (_tmp2_, "current", self);
#line 41 "../src/KeyboardManager.vala"
	return obj;
#line 1170 "KeyboardManager.c"
}

static void
gala_keyboard_manager_class_init (GalaKeyboardManagerClass * klass,
                                  gpointer klass_data)
{
	GVariantType* _tmp0_;
	GSettingsSchema* schema = NULL;
	GSettingsSchemaSource* _tmp1_;
	GSettingsSchema* _tmp2_;
	GSettingsSchema* _tmp3_;
	GSettingsSchema* _tmp4_;
	GSettings* _tmp5_;
#line 7 "../src/KeyboardManager.vala"
	gala_keyboard_manager_parent_class = g_type_class_peek_parent (klass);
#line 7 "../src/KeyboardManager.vala"
	g_type_class_adjust_private_offset (klass, &GalaKeyboardManager_private_offset);
#line 7 "../src/KeyboardManager.vala"
	G_OBJECT_CLASS (klass)->get_property = _vala_gala_keyboard_manager_get_property;
#line 7 "../src/KeyboardManager.vala"
	G_OBJECT_CLASS (klass)->set_property = _vala_gala_keyboard_manager_set_property;
#line 7 "../src/KeyboardManager.vala"
	G_OBJECT_CLASS (klass)->constructor = gala_keyboard_manager_constructor;
#line 7 "../src/KeyboardManager.vala"
	G_OBJECT_CLASS (klass)->finalize = gala_keyboard_manager_finalize;
#line 7 "../src/KeyboardManager.vala"
	g_object_class_install_property (G_OBJECT_CLASS (klass), GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY, gala_keyboard_manager_properties[GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY] = g_param_spec_object ("display", "display", "display", meta_display_get_type (), G_PARAM_STATIC_STRINGS | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
#line 31 "../src/KeyboardManager.vala"
	_tmp0_ = g_variant_type_new ("a(ss)");
#line 31 "../src/KeyboardManager.vala"
	_g_variant_type_free0 (gala_keyboard_manager_sources_variant_type);
#line 31 "../src/KeyboardManager.vala"
	gala_keyboard_manager_sources_variant_type = _tmp0_;
#line 33 "../src/KeyboardManager.vala"
	_tmp1_ = g_settings_schema_source_get_default ();
#line 33 "../src/KeyboardManager.vala"
	_tmp2_ = g_settings_schema_source_lookup (_tmp1_, "org.gnome.desktop.input-sources", TRUE);
#line 33 "../src/KeyboardManager.vala"
	schema = _tmp2_;
#line 34 "../src/KeyboardManager.vala"
	_tmp3_ = schema;
#line 34 "../src/KeyboardManager.vala"
	if (_tmp3_ == NULL) {
#line 35 "../src/KeyboardManager.vala"
		g_critical ("KeyboardManager.vala:35: org.gnome.desktop.input-sources not found.");
#line 1216 "KeyboardManager.c"
	}
#line 38 "../src/KeyboardManager.vala"
	_tmp4_ = schema;
#line 38 "../src/KeyboardManager.vala"
	_tmp5_ = g_settings_new_full (_tmp4_, NULL, NULL);
#line 38 "../src/KeyboardManager.vala"
	_g_object_unref0 (gala_keyboard_manager_settings);
#line 38 "../src/KeyboardManager.vala"
	gala_keyboard_manager_settings = _tmp5_;
#line 30 "../src/KeyboardManager.vala"
	_g_settings_schema_unref0 (schema);
#line 1228 "KeyboardManager.c"
}

static void
gala_keyboard_manager_instance_init (GalaKeyboardManager * self,
                                     gpointer klass)
{
#line 7 "../src/KeyboardManager.vala"
	self->priv = gala_keyboard_manager_get_instance_private (self);
#line 1237 "KeyboardManager.c"
}

static void
gala_keyboard_manager_finalize (GObject * obj)
{
	GalaKeyboardManager * self;
#line 7 "../src/KeyboardManager.vala"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManager);
#line 7 "../src/KeyboardManager.vala"
	G_OBJECT_CLASS (gala_keyboard_manager_parent_class)->finalize (obj);
#line 1248 "KeyboardManager.c"
}

 G_GNUC_NO_INLINE static GType
gala_keyboard_manager_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (GalaKeyboardManagerClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) gala_keyboard_manager_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (GalaKeyboardManager), 0, (GInstanceInitFunc) gala_keyboard_manager_instance_init, NULL };
	GType gala_keyboard_manager_type_id;
	gala_keyboard_manager_type_id = g_type_register_static (G_TYPE_OBJECT, "GalaKeyboardManager", &g_define_type_info, 0);
	GalaKeyboardManager_private_offset = g_type_add_instance_private (gala_keyboard_manager_type_id, sizeof (GalaKeyboardManagerPrivate));
	return gala_keyboard_manager_type_id;
}

GType
gala_keyboard_manager_get_type (void)
{
	static gsize gala_keyboard_manager_type_id__once = 0;
	if (g_once_init_enter (&gala_keyboard_manager_type_id__once)) {
		GType gala_keyboard_manager_type_id;
		gala_keyboard_manager_type_id = gala_keyboard_manager_get_type_once ();
		g_once_init_leave (&gala_keyboard_manager_type_id__once, gala_keyboard_manager_type_id);
	}
	return gala_keyboard_manager_type_id__once;
}

static void
_vala_gala_keyboard_manager_get_property (GObject * object,
                                          guint property_id,
                                          GValue * value,
                                          GParamSpec * pspec)
{
	GalaKeyboardManager * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManager);
#line 7 "../src/KeyboardManager.vala"
	switch (property_id) {
#line 7 "../src/KeyboardManager.vala"
		case GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY:
#line 7 "../src/KeyboardManager.vala"
		g_value_set_object (value, gala_keyboard_manager_get_display (self));
#line 7 "../src/KeyboardManager.vala"
		break;
#line 1289 "KeyboardManager.c"
		default:
#line 7 "../src/KeyboardManager.vala"
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
#line 7 "../src/KeyboardManager.vala"
		break;
#line 1295 "KeyboardManager.c"
	}
}

static void
_vala_gala_keyboard_manager_set_property (GObject * object,
                                          guint property_id,
                                          const GValue * value,
                                          GParamSpec * pspec)
{
	GalaKeyboardManager * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, GALA_TYPE_KEYBOARD_MANAGER, GalaKeyboardManager);
#line 7 "../src/KeyboardManager.vala"
	switch (property_id) {
#line 7 "../src/KeyboardManager.vala"
		case GALA_KEYBOARD_MANAGER_DISPLAY_PROPERTY:
#line 7 "../src/KeyboardManager.vala"
		gala_keyboard_manager_set_display (self, g_value_get_object (value));
#line 7 "../src/KeyboardManager.vala"
		break;
#line 1315 "KeyboardManager.c"
		default:
#line 7 "../src/KeyboardManager.vala"
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
#line 7 "../src/KeyboardManager.vala"
		break;
#line 1321 "KeyboardManager.c"
	}
}

static void
_vala_array_destroy (gpointer array,
                     gssize array_length,
                     GDestroyNotify destroy_func)
{
	if ((array != NULL) && (destroy_func != NULL)) {
		gssize i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}

static void
_vala_array_free (gpointer array,
                  gssize array_length,
                  GDestroyNotify destroy_func)
{
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}

static gssize
_vala_array_length (gpointer array)
{
	gssize length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}

