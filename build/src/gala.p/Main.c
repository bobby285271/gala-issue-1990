/* Main.c generated by valac 0.56.17, the Vala compiler
 * generated from Main.vala, do not modify */

/**/
/*  Copyright (C) 2012 Tom Beckmann, Rico Tzschichholz*/
/**/
/*  This program is free software: you can redistribute it and/or modify*/
/*  it under the terms of the GNU General Public License as published by*/
/*  the Free Software Foundation, either version 3 of the License, or*/
/*  (at your option) any later version.*/
/**/
/*  This program is distributed in the hope that it will be useful,*/
/*  but WITHOUT ANY WARRANTY; without even the implied warranty of*/
/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*/
/*  GNU General Public License for more details.*/
/**/
/*  You should have received a copy of the GNU General Public License*/
/*  along with this program.  If not, see <http://www.gnu.org/licenses/>.*/
/**/

#define _GNU_SOURCE

#include <glib.h>
#include <stdio.h>
#include "config.h"
#include <meta/main.h>
#include <meta/meta-context.h>
#include <locale.h>
#include <glib/gi18n-lib.h>
#include <stdlib.h>
#include <glib-object.h>
#include <meta/meta-plugin.h>
#include <sys/select.h>
#include <signal.h>
#include <errno.h>
#include <glib-unix.h>
#include "gala.h"
#include <meta/meta-enums.h>

#if !defined(VALA_STRICT_C)
#if !defined(__clang__) && defined(__GNUC__) && (__GNUC__ >= 14)
#pragma GCC diagnostic warning "-Wincompatible-pointer-types"
#elif defined(__clang__) && (__clang_major__ >= 16)
#pragma clang diagnostic ignored "-Wincompatible-function-pointer-types"
#pragma clang diagnostic ignored "-Wincompatible-pointer-types"
#endif
#endif
#if !defined(VALA_EXTERN)
#if defined(_MSC_VER)
#define VALA_EXTERN __declspec(dllexport) extern
#elif __GNUC__ >= 4
#define VALA_EXTERN __attribute__((visibility("default"))) extern
#else
#define VALA_EXTERN extern
#endif
#endif

typedef struct _Block2Data Block2Data;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

#define GALA_TYPE_WINDOW_MANAGER_GALA (gala_window_manager_gala_get_type ())
#define GALA_WINDOW_MANAGER_GALA(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GALA_TYPE_WINDOW_MANAGER_GALA, GalaWindowManagerGala))
#define GALA_WINDOW_MANAGER_GALA_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GALA_TYPE_WINDOW_MANAGER_GALA, GalaWindowManagerGalaClass))
#define GALA_IS_WINDOW_MANAGER_GALA(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GALA_TYPE_WINDOW_MANAGER_GALA))
#define GALA_IS_WINDOW_MANAGER_GALA_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GALA_TYPE_WINDOW_MANAGER_GALA))
#define GALA_WINDOW_MANAGER_GALA_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GALA_TYPE_WINDOW_MANAGER_GALA, GalaWindowManagerGalaClass))

typedef struct _GalaWindowManagerGala GalaWindowManagerGala;
typedef struct _GalaWindowManagerGalaClass GalaWindowManagerGalaClass;
#define _g_type_class_unref0(var) ((var == NULL) ? NULL : (var = (g_type_class_unref (var), NULL)))

struct _Block2Data {
	int _ref_count_;
	MetaContext* ctx;
};

 G_GNUC_INTERNAL void gala_print_version (void);
static gint gala_main (gchar** args,
                gint args_length1);
static Block2Data* block2_data_ref (Block2Data* _data2_);
static void block2_data_unref (void * _userdata_);
VALA_EXTERN GType gala_window_manager_gala_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (GalaWindowManagerGala, g_object_unref)
static gboolean __lambda209_ (Block2Data* _data2_);
static gboolean ___lambda209__gsource_func (gpointer self);
VALA_EXTERN void gala_init_pantheon_shell (MetaContext* context);

const GOptionEntry GALA_OPTIONS[2] = {{"version", (gchar) 0, (gint) G_OPTION_FLAG_NO_ARG, G_OPTION_ARG_CALLBACK, (void*) gala_print_version, "Print version", NULL}, {NULL}};

 G_GNUC_INTERNAL void
gala_print_version (void)
{
	FILE* _tmp0_;
#line 25 "../src/Main.vala"
	_tmp0_ = stdout;
#line 25 "../src/Main.vala"
	fprintf (_tmp0_, "Gala %s\n", VERSION);
#line 26 "../src/Main.vala"
	meta_exit (META_EXIT_SUCCESS);
#line 102 "Main.c"
}

static Block2Data*
block2_data_ref (Block2Data* _data2_)
{
#line 29 "../src/Main.vala"
	g_atomic_int_inc (&_data2_->_ref_count_);
#line 29 "../src/Main.vala"
	return _data2_;
#line 112 "Main.c"
}

static void
block2_data_unref (void * _userdata_)
{
	Block2Data* _data2_;
	_data2_ = (Block2Data*) _userdata_;
#line 29 "../src/Main.vala"
	if (g_atomic_int_dec_and_test (&_data2_->_ref_count_)) {
#line 29 "../src/Main.vala"
		_g_object_unref0 (_data2_->ctx);
#line 29 "../src/Main.vala"
		g_slice_free (Block2Data, _data2_);
#line 126 "Main.c"
	}
}

static gboolean
__lambda209_ (Block2Data* _data2_)
{
	MetaContext* _tmp0_;
	gboolean result;
#line 62 "../src/Main.vala"
	_tmp0_ = _data2_->ctx;
#line 62 "../src/Main.vala"
	meta_context_terminate (_tmp0_);
#line 63 "../src/Main.vala"
	result = G_SOURCE_REMOVE;
#line 63 "../src/Main.vala"
	return result;
#line 143 "Main.c"
}

static gboolean
___lambda209__gsource_func (gpointer self)
{
	gboolean result;
	result = __lambda209_ (self);
#line 61 "../src/Main.vala"
	return result;
#line 153 "Main.c"
}

static gint
gala_main (gchar** args,
           gint args_length1)
{
	Block2Data* _data2_;
	MetaContext* _tmp0_;
	MetaContext* _tmp1_;
	MetaContext* _tmp7_;
	sigset_t empty_mask = {0};
	sigset_t _tmp8_ = {0};
	struct sigaction act = {0};
	struct sigaction _tmp9_ = {0};
	sighandler_t _tmp10_;
	sigset_t _tmp11_;
	struct sigaction _tmp12_;
	struct sigaction _tmp14_;
	GTypeClass* _tmp21_;
	GTypeClass* _tmp22_;
	GError* _inner_error0_ = NULL;
	gint result;
#line 29 "../src/Main.vala"
	_data2_ = g_slice_new0 (Block2Data);
#line 29 "../src/Main.vala"
	_data2_->_ref_count_ = 1;
#line 30 "../src/Main.vala"
	setlocale (LC_ALL, "");
#line 31 "../src/Main.vala"
	bindtextdomain (GETTEXT_PACKAGE, LOCALEDIR);
#line 32 "../src/Main.vala"
	bind_textdomain_codeset (GETTEXT_PACKAGE, "UTF-8");
#line 33 "../src/Main.vala"
	textdomain (GETTEXT_PACKAGE);
#line 35 "../src/Main.vala"
	_tmp0_ = meta_create_context ("Mutter(Gala)");
#line 35 "../src/Main.vala"
	_data2_->ctx = _tmp0_;
#line 36 "../src/Main.vala"
	_tmp1_ = _data2_->ctx;
#line 36 "../src/Main.vala"
	meta_context_add_option_entries (_tmp1_, GALA_OPTIONS, GETTEXT_PACKAGE);
#line 196 "Main.c"
	{
		MetaContext* _tmp2_;
#line 38 "../src/Main.vala"
		_tmp2_ = _data2_->ctx;
#line 38 "../src/Main.vala"
		meta_context_configure (_tmp2_, (gint*) (&args_length1), &args, &_inner_error0_);
#line 38 "../src/Main.vala"
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 205 "Main.c"
			goto __catch0_g_error;
		}
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		FILE* _tmp3_;
		GError* _tmp4_;
		const gchar* _tmp5_;
#line 37 "../src/Main.vala"
		e = _inner_error0_;
#line 37 "../src/Main.vala"
		_inner_error0_ = NULL;
#line 40 "../src/Main.vala"
		_tmp3_ = stderr;
#line 40 "../src/Main.vala"
		_tmp4_ = e;
#line 40 "../src/Main.vala"
		_tmp5_ = _tmp4_->message;
#line 40 "../src/Main.vala"
		fprintf (_tmp3_, "Error initializing: %s\n", _tmp5_);
#line 41 "../src/Main.vala"
		result = EXIT_FAILURE;
#line 41 "../src/Main.vala"
		_g_error_free0 (e);
#line 41 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 41 "../src/Main.vala"
		_data2_ = NULL;
#line 41 "../src/Main.vala"
		return result;
#line 238 "Main.c"
	}
	__finally0:
#line 37 "../src/Main.vala"
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 243 "Main.c"
		gint _tmp6_ = -1;
#line 37 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 37 "../src/Main.vala"
		_data2_ = NULL;
#line 37 "../src/Main.vala"
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
#line 37 "../src/Main.vala"
		g_clear_error (&_inner_error0_);
#line 37 "../src/Main.vala"
		return _tmp6_;
#line 255 "Main.c"
	}
#line 45 "../src/Main.vala"
	_tmp7_ = _data2_->ctx;
#line 45 "../src/Main.vala"
	meta_context_set_plugin_gtype (_tmp7_, GALA_TYPE_WINDOW_MANAGER_GALA);
#line 47 "../src/Main.vala"
	sigemptyset (&_tmp8_);
#line 47 "../src/Main.vala"
	empty_mask = _tmp8_;
#line 48 "../src/Main.vala"
	act = _tmp9_;
#line 49 "../src/Main.vala"
	_tmp10_ = SIG_IGN;
#line 49 "../src/Main.vala"
	act.sa_handler = _tmp10_;
#line 50 "../src/Main.vala"
	_tmp11_ = empty_mask;
#line 50 "../src/Main.vala"
	act.sa_mask = _tmp11_;
#line 51 "../src/Main.vala"
	act.sa_flags = 0;
#line 53 "../src/Main.vala"
	_tmp12_ = act;
#line 53 "../src/Main.vala"
	if (sigaction ((gint) SIGPIPE, &_tmp12_, NULL) < 0) {
#line 281 "Main.c"
		const gchar* _tmp13_;
#line 54 "../src/Main.vala"
		_tmp13_ = g_strerror (errno);
#line 54 "../src/Main.vala"
		g_warning ("Main.vala:54: Failed to register SIGPIPE handler: %s", _tmp13_);
#line 287 "Main.c"
	}
#line 57 "../src/Main.vala"
	_tmp14_ = act;
#line 57 "../src/Main.vala"
	if (sigaction ((gint) SIGXFSZ, &_tmp14_, NULL) < 0) {
#line 293 "Main.c"
		const gchar* _tmp15_;
#line 58 "../src/Main.vala"
		_tmp15_ = g_strerror (errno);
#line 58 "../src/Main.vala"
		g_warning ("Main.vala:58: Failed to register SIGXFSZ handler: %s", _tmp15_);
#line 299 "Main.c"
	}
#line 61 "../src/Main.vala"
	g_unix_signal_add_full (G_PRIORITY_DEFAULT, (gint) SIGTERM, ___lambda209__gsource_func, block2_data_ref (_data2_), block2_data_unref);
#line 303 "Main.c"
	{
		MetaContext* _tmp16_;
#line 67 "../src/Main.vala"
		_tmp16_ = _data2_->ctx;
#line 67 "../src/Main.vala"
		meta_context_setup (_tmp16_, &_inner_error0_);
#line 67 "../src/Main.vala"
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 312 "Main.c"
			goto __catch1_g_error;
		}
	}
	goto __finally1;
	__catch1_g_error:
	{
		GError* e = NULL;
		FILE* _tmp17_;
		GError* _tmp18_;
		const gchar* _tmp19_;
#line 66 "../src/Main.vala"
		e = _inner_error0_;
#line 66 "../src/Main.vala"
		_inner_error0_ = NULL;
#line 69 "../src/Main.vala"
		_tmp17_ = stderr;
#line 69 "../src/Main.vala"
		_tmp18_ = e;
#line 69 "../src/Main.vala"
		_tmp19_ = _tmp18_->message;
#line 69 "../src/Main.vala"
		fprintf (_tmp17_, "Failed to setup: %s\n", _tmp19_);
#line 70 "../src/Main.vala"
		result = EXIT_FAILURE;
#line 70 "../src/Main.vala"
		_g_error_free0 (e);
#line 70 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 70 "../src/Main.vala"
		_data2_ = NULL;
#line 70 "../src/Main.vala"
		return result;
#line 345 "Main.c"
	}
	__finally1:
#line 66 "../src/Main.vala"
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 350 "Main.c"
		gint _tmp20_ = -1;
#line 66 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 66 "../src/Main.vala"
		_data2_ = NULL;
#line 66 "../src/Main.vala"
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
#line 66 "../src/Main.vala"
		g_clear_error (&_inner_error0_);
#line 66 "../src/Main.vala"
		return _tmp20_;
#line 362 "Main.c"
	}
#line 75 "../src/Main.vala"
	_tmp21_ = g_type_class_ref (GALA_TYPE_UTILS);
#line 75 "../src/Main.vala"
	_tmp22_ = _tmp21_;
#line 75 "../src/Main.vala"
	_g_type_class_unref0 (_tmp22_);
#line 370 "Main.c"
	{
		MetaContext* _tmp23_;
		MetaContext* _tmp24_;
#line 78 "../src/Main.vala"
		_tmp23_ = _data2_->ctx;
#line 78 "../src/Main.vala"
		meta_context_start (_tmp23_, &_inner_error0_);
#line 78 "../src/Main.vala"
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 380 "Main.c"
			goto __catch2_g_error;
		}
#line 79 "../src/Main.vala"
		_tmp24_ = _data2_->ctx;
#line 79 "../src/Main.vala"
		if (meta_context_get_compositor_type (_tmp24_) == META_COMPOSITOR_TYPE_WAYLAND) {
#line 387 "Main.c"
			MetaContext* _tmp25_;
#line 80 "../src/Main.vala"
			_tmp25_ = _data2_->ctx;
#line 80 "../src/Main.vala"
			gala_init_pantheon_shell (_tmp25_);
#line 393 "Main.c"
		}
	}
	goto __finally2;
	__catch2_g_error:
	{
		GError* e = NULL;
		FILE* _tmp26_;
		GError* _tmp27_;
		const gchar* _tmp28_;
#line 77 "../src/Main.vala"
		e = _inner_error0_;
#line 77 "../src/Main.vala"
		_inner_error0_ = NULL;
#line 83 "../src/Main.vala"
		_tmp26_ = stderr;
#line 83 "../src/Main.vala"
		_tmp27_ = e;
#line 83 "../src/Main.vala"
		_tmp28_ = _tmp27_->message;
#line 83 "../src/Main.vala"
		fprintf (_tmp26_, "Failed to start: %s\n", _tmp28_);
#line 84 "../src/Main.vala"
		result = EXIT_FAILURE;
#line 84 "../src/Main.vala"
		_g_error_free0 (e);
#line 84 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 84 "../src/Main.vala"
		_data2_ = NULL;
#line 84 "../src/Main.vala"
		return result;
#line 425 "Main.c"
	}
	__finally2:
#line 77 "../src/Main.vala"
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 430 "Main.c"
		gint _tmp29_ = -1;
#line 77 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 77 "../src/Main.vala"
		_data2_ = NULL;
#line 77 "../src/Main.vala"
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
#line 77 "../src/Main.vala"
		g_clear_error (&_inner_error0_);
#line 77 "../src/Main.vala"
		return _tmp29_;
#line 442 "Main.c"
	}
	{
		MetaContext* _tmp30_;
#line 88 "../src/Main.vala"
		_tmp30_ = _data2_->ctx;
#line 88 "../src/Main.vala"
		meta_context_run_main_loop (_tmp30_, &_inner_error0_);
#line 88 "../src/Main.vala"
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 452 "Main.c"
			goto __catch3_g_error;
		}
	}
	goto __finally3;
	__catch3_g_error:
	{
		GError* e = NULL;
		FILE* _tmp31_;
		GError* _tmp32_;
		const gchar* _tmp33_;
#line 87 "../src/Main.vala"
		e = _inner_error0_;
#line 87 "../src/Main.vala"
		_inner_error0_ = NULL;
#line 90 "../src/Main.vala"
		_tmp31_ = stderr;
#line 90 "../src/Main.vala"
		_tmp32_ = e;
#line 90 "../src/Main.vala"
		_tmp33_ = _tmp32_->message;
#line 90 "../src/Main.vala"
		fprintf (_tmp31_, "Gala terminated with a failure: %s\n", _tmp33_);
#line 91 "../src/Main.vala"
		result = EXIT_FAILURE;
#line 91 "../src/Main.vala"
		_g_error_free0 (e);
#line 91 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 91 "../src/Main.vala"
		_data2_ = NULL;
#line 91 "../src/Main.vala"
		return result;
#line 485 "Main.c"
	}
	__finally3:
#line 87 "../src/Main.vala"
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
#line 490 "Main.c"
		gint _tmp34_ = -1;
#line 87 "../src/Main.vala"
		block2_data_unref (_data2_);
#line 87 "../src/Main.vala"
		_data2_ = NULL;
#line 87 "../src/Main.vala"
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
#line 87 "../src/Main.vala"
		g_clear_error (&_inner_error0_);
#line 87 "../src/Main.vala"
		return _tmp34_;
#line 502 "Main.c"
	}
#line 94 "../src/Main.vala"
	result = EXIT_SUCCESS;
#line 94 "../src/Main.vala"
	block2_data_unref (_data2_);
#line 94 "../src/Main.vala"
	_data2_ = NULL;
#line 94 "../src/Main.vala"
	return result;
#line 512 "Main.c"
}

int
main (int argc,
      char ** argv)
{
#line 29 "../src/Main.vala"
	return gala_main (argv, argc);
#line 521 "Main.c"
}

