/* Main.c generated by valac 0.56.17, the Vala compiler
 * generated from Main.vala, do not modify */

/**/
/*  Copyright (C) 2017 Adam Bie≈Ñkowski*/
/**/
/*  This program is free software: you can redistribute it and/or modify*/
/*  it under the terms of the GNU General Public License as published by*/
/*  the Free Software Foundation, either version 3 of the License, or*/
/*  (at your option) any later version.*/
/**/
/*  This program is distributed in the hope that it will be useful,*/
/*  but WITHOUT ANY WARRANTY; without even the implied warranty of*/
/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*/
/*  GNU General Public License for more details.*/
/**/
/*  You should have received a copy of the GNU General Public License*/
/*  along with this program.  If not, see <http://www.gnu.org/licenses/>.*/
/**/

#include "gala-pip.h"
#include <gee.h>
#include <glib-object.h>
#include "gala.h"
#include <glib.h>
#include <mtk/mtk.h>
#include <meta/display.h>
#include <meta/meta-plugin.h>
#include <gio/gio.h>
#include "config.h"
#include <meta/prefs.h>
#include <meta/window.h>
#include <clutter/clutter.h>
#include <meta/keybindings.h>
#include <meta/meta-window-actor.h>
#include <float.h>
#include <math.h>
#include <graphene-gobject.h>
#include <meta/compositor-mutter.h>
#include <stdlib.h>
#include <string.h>

#define GALA_PLUGINS_PIP_PLUGIN_MIN_SELECTION_SIZE 30
#if !defined(VALA_STRICT_C)
#if !defined(__clang__) && defined(__GNUC__) && (__GNUC__ >= 14)
#pragma GCC diagnostic warning "-Wincompatible-pointer-types"
#elif defined(__clang__) && (__clang_major__ >= 16)
#pragma clang diagnostic ignored "-Wincompatible-function-pointer-types"
#pragma clang diagnostic ignored "-Wincompatible-pointer-types"
#endif
#endif

enum  {
	GALA_PLUGINS_PIP_PLUGIN_0_PROPERTY,
	GALA_PLUGINS_PIP_PLUGIN_NUM_PROPERTIES
};
static GParamSpec* gala_plugins_pip_plugin_properties[GALA_PLUGINS_PIP_PLUGIN_NUM_PROPERTIES];
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define __vala_graphene_rect_t_free0(var) ((var == NULL) ? NULL : (var = (_vala_graphene_rect_t_free (var), NULL)))
typedef struct _Block1Data Block1Data;
typedef struct _Block2Data Block2Data;
typedef struct _Block3Data Block3Data;
#define _g_free0(var) (var = (g_free (var), NULL))

struct _GalaPluginsPIPPluginPrivate {
	GeeArrayList* windows;
	GalaWindowManager* wm;
	GalaPluginsPIPSelectionArea* selection_area;
};

struct _Block1Data {
	int _ref_count_;
	GalaPluginsPIPPlugin* self;
	MetaWindowActor* selected;
	gint x;
	gint y;
};

struct _Block2Data {
	int _ref_count_;
	GalaPluginsPIPPlugin* self;
	MetaWindowActor* active;
};

struct _Block3Data {
	int _ref_count_;
	GalaPluginsPIPPlugin* self;
	GalaPluginsPIPPopupWindow* popup_window;
};

static gint GalaPluginsPIPPlugin_private_offset;
static gpointer gala_plugins_pip_plugin_parent_class = NULL;

static inline gboolean gala_plugins_pip_plugin_meta_rectangle_contains (MtkRectangle* rect,
                                                          gint x,
                                                          gint y);
static void gala_plugins_pip_plugin_real_initialize (GalaPlugin* base,
                                              GalaWindowManager* wm);
static void gala_plugins_pip_plugin_on_initiate (MetaDisplay* display,
                                          MetaWindow* window,
                                          ClutterKeyEvent* event,
                                          MetaKeyBinding* binding,
                                          GalaPluginsPIPPlugin* self);
static void gala_plugins_pip_plugin_real_destroy (GalaPlugin* base);
static void gala_plugins_pip_plugin_clear_selection_area (GalaPluginsPIPPlugin* self);
static void gala_plugins_pip_plugin_untrack_window (GalaPluginsPIPPlugin* self,
                                             GalaPluginsPIPPopupWindow* popup_window);
static void gala_plugins_pip_plugin_on_selection_actor_selected (GalaPluginsPIPPlugin* self,
                                                          gint x,
                                                          gint y);
static void _gala_plugins_pip_plugin_on_selection_actor_selected_gala_plugins_pip_selection_area_selected (GalaPluginsPIPSelectionArea* _sender,
                                                                                                    gint x,
                                                                                                    gint y,
                                                                                                    gpointer self);
static void gala_plugins_pip_plugin_on_selection_actor_captured (GalaPluginsPIPPlugin* self,
                                                          gint x,
                                                          gint y,
                                                          gint width,
                                                          gint height);
static void _gala_plugins_pip_plugin_on_selection_actor_captured_gala_plugins_pip_selection_area_captured (GalaPluginsPIPSelectionArea* _sender,
                                                                                                    gint x,
                                                                                                    gint y,
                                                                                                    gint width,
                                                                                                    gint height,
                                                                                                    gpointer self);
static void _gala_plugins_pip_plugin_clear_selection_area_gala_plugins_pip_selection_area_closed (GalaPluginsPIPSelectionArea* _sender,
                                                                                           gpointer self);
static void gala_plugins_pip_plugin_select_window_at (GalaPluginsPIPPlugin* self,
                                               gint x,
                                               gint y);
static MetaWindowActor* gala_plugins_pip_plugin_get_active_window_actor (GalaPluginsPIPPlugin* self);
static void gala_plugins_pip_plugin_on_popup_window_show (GalaPluginsPIPPlugin* self,
                                                   ClutterActor* popup_window);
static void _gala_plugins_pip_plugin_on_popup_window_show_clutter_actor_show (ClutterActor* _sender,
                                                                       gpointer self);
static void gala_plugins_pip_plugin_on_popup_window_hide (GalaPluginsPIPPlugin* self,
                                                   ClutterActor* popup_window);
static void _gala_plugins_pip_plugin_on_popup_window_hide_clutter_actor_hide (ClutterActor* _sender,
                                                                       gpointer self);
static void gala_plugins_pip_plugin_add_window (GalaPluginsPIPPlugin* self,
                                         GalaPluginsPIPPopupWindow* popup_window);
static void _vala_graphene_rect_t_free (graphene_rect_t* self);
static MetaWindowActor* gala_plugins_pip_plugin_get_window_actor_at (GalaPluginsPIPPlugin* self,
                                                              gint x,
                                                              gint y);
static Block1Data* block1_data_ref (Block1Data* _data1_);
static void block1_data_unref (void * _userdata_);
static void __lambda6_ (Block1Data* _data1_,
                 MetaWindowActor* actor);
static void ___lambda6__gfunc (gconstpointer data,
                        gpointer self);
static Block2Data* block2_data_ref (Block2Data* _data2_);
static void block2_data_unref (void * _userdata_);
static void __lambda8_ (Block2Data* _data2_,
                 MetaWindowActor* actor);
static void ___lambda8__gfunc (gconstpointer data,
                        gpointer self);
static Block3Data* block3_data_ref (Block3Data* _data3_);
static void block3_data_unref (void * _userdata_);
static void __lambda7_ (Block3Data* _data3_);
static void gala_plugins_pip_plugin_remove_window (GalaPluginsPIPPlugin* self,
                                            GalaPluginsPIPPopupWindow* popup_window);
static void ___lambda7__gala_plugins_pip_popup_window_closed (GalaPluginsPIPPopupWindow* _sender,
                                                       gpointer self);
static GObject * gala_plugins_pip_plugin_constructor (GType type,
                                               guint n_construct_properties,
                                               GObjectConstructParam * construct_properties);
static void gala_plugins_pip_plugin_finalize (GObject * obj);
static GType gala_plugins_pip_plugin_get_type_once (void);

static inline gpointer
gala_plugins_pip_plugin_get_instance_private (GalaPluginsPIPPlugin* self)
{
	return G_STRUCT_MEMBER_P (self, GalaPluginsPIPPlugin_private_offset);
}

static inline gboolean
gala_plugins_pip_plugin_meta_rectangle_contains (MtkRectangle* rect,
                                                 gint x,
                                                 gint y)
{
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	gboolean _tmp2_ = FALSE;
	MtkRectangle _tmp3_;
	gboolean result;
#line 26 "../plugins/pip/Main.vala"
	g_return_val_if_fail (rect != NULL, FALSE);
#line 30 "../plugins/pip/Main.vala"
	_tmp3_ = *rect;
#line 30 "../plugins/pip/Main.vala"
	if (x >= _tmp3_.x) {
#line 194 "Main.c"
		MtkRectangle _tmp4_;
		MtkRectangle _tmp5_;
#line 30 "../plugins/pip/Main.vala"
		_tmp4_ = *rect;
#line 30 "../plugins/pip/Main.vala"
		_tmp5_ = *rect;
#line 30 "../plugins/pip/Main.vala"
		_tmp2_ = x < (_tmp4_.x + _tmp5_.width);
#line 203 "Main.c"
	} else {
#line 30 "../plugins/pip/Main.vala"
		_tmp2_ = FALSE;
#line 207 "Main.c"
	}
#line 30 "../plugins/pip/Main.vala"
	if (_tmp2_) {
#line 211 "Main.c"
		MtkRectangle _tmp6_;
#line 31 "../plugins/pip/Main.vala"
		_tmp6_ = *rect;
#line 31 "../plugins/pip/Main.vala"
		_tmp1_ = y >= _tmp6_.y;
#line 217 "Main.c"
	} else {
#line 30 "../plugins/pip/Main.vala"
		_tmp1_ = FALSE;
#line 221 "Main.c"
	}
#line 30 "../plugins/pip/Main.vala"
	if (_tmp1_) {
#line 225 "Main.c"
		MtkRectangle _tmp7_;
		MtkRectangle _tmp8_;
#line 31 "../plugins/pip/Main.vala"
		_tmp7_ = *rect;
#line 31 "../plugins/pip/Main.vala"
		_tmp8_ = *rect;
#line 31 "../plugins/pip/Main.vala"
		_tmp0_ = y < (_tmp7_.y + _tmp8_.height);
#line 234 "Main.c"
	} else {
#line 30 "../plugins/pip/Main.vala"
		_tmp0_ = FALSE;
#line 238 "Main.c"
	}
#line 30 "../plugins/pip/Main.vala"
	result = _tmp0_;
#line 30 "../plugins/pip/Main.vala"
	return result;
#line 244 "Main.c"
}

static gpointer
_g_object_ref0 (gpointer self)
{
#line 39 "../plugins/pip/Main.vala"
	return self ? g_object_ref (self) : NULL;
#line 252 "Main.c"
}

static void
gala_plugins_pip_plugin_real_initialize (GalaPlugin* base,
                                         GalaWindowManager* wm)
{
	GalaPluginsPIPPlugin * self;
	GalaWindowManager* _tmp0_;
	MetaDisplay* display = NULL;
	MetaDisplay* _tmp1_;
	MetaDisplay* _tmp2_;
	GSettings* settings = NULL;
	GSettings* _tmp3_;
#line 38 "../plugins/pip/Main.vala"
	self = (GalaPluginsPIPPlugin*) base;
#line 38 "../plugins/pip/Main.vala"
	g_return_if_fail (wm != NULL);
#line 39 "../plugins/pip/Main.vala"
	_tmp0_ = _g_object_ref0 (wm);
#line 39 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->wm);
#line 39 "../plugins/pip/Main.vala"
	self->priv->wm = _tmp0_;
#line 40 "../plugins/pip/Main.vala"
	_tmp1_ = meta_plugin_get_display ((MetaPlugin*) wm);
#line 40 "../plugins/pip/Main.vala"
	_tmp2_ = _g_object_ref0 (_tmp1_);
#line 40 "../plugins/pip/Main.vala"
	display = _tmp2_;
#line 41 "../plugins/pip/Main.vala"
	_tmp3_ = g_settings_new (SCHEMA ".keybindings");
#line 41 "../plugins/pip/Main.vala"
	settings = _tmp3_;
#line 43 "../plugins/pip/Main.vala"
	meta_display_add_keybinding (display, "pip", settings, META_KEY_BINDING_IGNORE_AUTOREPEAT, (MetaKeyHandlerFunc) gala_plugins_pip_plugin_on_initiate, g_object_ref (self), g_object_unref);
#line 38 "../plugins/pip/Main.vala"
	_g_object_unref0 (settings);
#line 38 "../plugins/pip/Main.vala"
	_g_object_unref0 (display);
#line 292 "Main.c"
}

static void
gala_plugins_pip_plugin_real_destroy (GalaPlugin* base)
{
	GalaPluginsPIPPlugin * self;
	GeeArrayList* _tmp9_;
#line 46 "../plugins/pip/Main.vala"
	self = (GalaPluginsPIPPlugin*) base;
#line 47 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_clear_selection_area (self);
#line 304 "Main.c"
	{
		GeeArrayList* _popup_window_list = NULL;
		GeeArrayList* _tmp0_;
		gint _popup_window_size = 0;
		GeeArrayList* _tmp1_;
		gint _tmp2_;
		gint _tmp3_;
		gint _popup_window_index = 0;
#line 49 "../plugins/pip/Main.vala"
		_tmp0_ = self->priv->windows;
#line 49 "../plugins/pip/Main.vala"
		_popup_window_list = _tmp0_;
#line 49 "../plugins/pip/Main.vala"
		_tmp1_ = _popup_window_list;
#line 49 "../plugins/pip/Main.vala"
		_tmp2_ = gee_abstract_collection_get_size ((GeeAbstractCollection*) _tmp1_);
#line 49 "../plugins/pip/Main.vala"
		_tmp3_ = _tmp2_;
#line 49 "../plugins/pip/Main.vala"
		_popup_window_size = _tmp3_;
#line 49 "../plugins/pip/Main.vala"
		_popup_window_index = -1;
#line 49 "../plugins/pip/Main.vala"
		while (TRUE) {
#line 329 "Main.c"
			gint _tmp4_;
			gint _tmp5_;
			GalaPluginsPIPPopupWindow* popup_window = NULL;
			GeeArrayList* _tmp6_;
			gpointer _tmp7_;
			GalaPluginsPIPPopupWindow* _tmp8_;
#line 49 "../plugins/pip/Main.vala"
			_popup_window_index = _popup_window_index + 1;
#line 49 "../plugins/pip/Main.vala"
			_tmp4_ = _popup_window_index;
#line 49 "../plugins/pip/Main.vala"
			_tmp5_ = _popup_window_size;
#line 49 "../plugins/pip/Main.vala"
			if (!(_tmp4_ < _tmp5_)) {
#line 49 "../plugins/pip/Main.vala"
				break;
#line 346 "Main.c"
			}
#line 49 "../plugins/pip/Main.vala"
			_tmp6_ = _popup_window_list;
#line 49 "../plugins/pip/Main.vala"
			_tmp7_ = gee_abstract_list_get ((GeeAbstractList*) _tmp6_, _popup_window_index);
#line 49 "../plugins/pip/Main.vala"
			popup_window = (GalaPluginsPIPPopupWindow*) _tmp7_;
#line 50 "../plugins/pip/Main.vala"
			_tmp8_ = popup_window;
#line 50 "../plugins/pip/Main.vala"
			gala_plugins_pip_plugin_untrack_window (self, _tmp8_);
#line 49 "../plugins/pip/Main.vala"
			_g_object_unref0 (popup_window);
#line 360 "Main.c"
		}
	}
#line 53 "../plugins/pip/Main.vala"
	_tmp9_ = self->priv->windows;
#line 53 "../plugins/pip/Main.vala"
	gee_abstract_collection_clear ((GeeAbstractCollection*) _tmp9_);
#line 367 "Main.c"
}

static void
_gala_plugins_pip_plugin_on_selection_actor_selected_gala_plugins_pip_selection_area_selected (GalaPluginsPIPSelectionArea* _sender,
                                                                                               gint x,
                                                                                               gint y,
                                                                                               gpointer self)
{
#line 60 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_on_selection_actor_selected ((GalaPluginsPIPPlugin*) self, x, y);
#line 378 "Main.c"
}

static void
_gala_plugins_pip_plugin_on_selection_actor_captured_gala_plugins_pip_selection_area_captured (GalaPluginsPIPSelectionArea* _sender,
                                                                                               gint x,
                                                                                               gint y,
                                                                                               gint width,
                                                                                               gint height,
                                                                                               gpointer self)
{
#line 61 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_on_selection_actor_captured ((GalaPluginsPIPPlugin*) self, x, y, width, height);
#line 391 "Main.c"
}

static void
_gala_plugins_pip_plugin_clear_selection_area_gala_plugins_pip_selection_area_closed (GalaPluginsPIPSelectionArea* _sender,
                                                                                      gpointer self)
{
#line 62 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_clear_selection_area ((GalaPluginsPIPPlugin*) self);
#line 400 "Main.c"
}

static void
gala_plugins_pip_plugin_on_initiate (MetaDisplay* display,
                                     MetaWindow* window,
                                     ClutterKeyEvent* event,
                                     MetaKeyBinding* binding,
                                     GalaPluginsPIPPlugin* self)
{
	GalaWindowManager* _tmp0_;
	GalaPluginsPIPSelectionArea* _tmp1_;
	GalaPluginsPIPSelectionArea* _tmp2_;
	GalaPluginsPIPSelectionArea* _tmp3_;
	GalaPluginsPIPSelectionArea* _tmp4_;
	GalaPluginsPIPSelectionArea* _tmp5_;
	GalaWindowManager* _tmp6_;
	ClutterActor* _tmp7_;
	ClutterActor* _tmp8_;
	GalaPluginsPIPSelectionArea* _tmp9_;
	GalaPluginsPIPSelectionArea* _tmp10_;
#line 57 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 57 "../plugins/pip/Main.vala"
	g_return_if_fail (display != NULL);
#line 57 "../plugins/pip/Main.vala"
	g_return_if_fail (event != NULL);
#line 57 "../plugins/pip/Main.vala"
	g_return_if_fail (binding != NULL);
#line 59 "../plugins/pip/Main.vala"
	_tmp0_ = self->priv->wm;
#line 59 "../plugins/pip/Main.vala"
	_tmp1_ = gala_plugins_pip_selection_area_new (_tmp0_);
#line 59 "../plugins/pip/Main.vala"
	g_object_ref_sink (_tmp1_);
#line 59 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->selection_area);
#line 59 "../plugins/pip/Main.vala"
	self->priv->selection_area = _tmp1_;
#line 60 "../plugins/pip/Main.vala"
	_tmp2_ = self->priv->selection_area;
#line 60 "../plugins/pip/Main.vala"
	g_signal_connect_object (_tmp2_, "selected", (GCallback) _gala_plugins_pip_plugin_on_selection_actor_selected_gala_plugins_pip_selection_area_selected, self, 0);
#line 61 "../plugins/pip/Main.vala"
	_tmp3_ = self->priv->selection_area;
#line 61 "../plugins/pip/Main.vala"
	g_signal_connect_object (_tmp3_, "captured", (GCallback) _gala_plugins_pip_plugin_on_selection_actor_captured_gala_plugins_pip_selection_area_captured, self, 0);
#line 62 "../plugins/pip/Main.vala"
	_tmp4_ = self->priv->selection_area;
#line 62 "../plugins/pip/Main.vala"
	g_signal_connect_object (_tmp4_, "closed", (GCallback) _gala_plugins_pip_plugin_clear_selection_area_gala_plugins_pip_selection_area_closed, self, 0);
#line 64 "../plugins/pip/Main.vala"
	_tmp5_ = self->priv->selection_area;
#line 64 "../plugins/pip/Main.vala"
	gala_plugin_track_actor ((GalaPlugin*) self, (ClutterActor*) _tmp5_);
#line 65 "../plugins/pip/Main.vala"
	_tmp6_ = self->priv->wm;
#line 65 "../plugins/pip/Main.vala"
	_tmp7_ = gala_window_manager_get_ui_group (_tmp6_);
#line 65 "../plugins/pip/Main.vala"
	_tmp8_ = _tmp7_;
#line 65 "../plugins/pip/Main.vala"
	_tmp9_ = self->priv->selection_area;
#line 65 "../plugins/pip/Main.vala"
	clutter_actor_add_child (_tmp8_, (ClutterActor*) _tmp9_);
#line 67 "../plugins/pip/Main.vala"
	_tmp10_ = self->priv->selection_area;
#line 67 "../plugins/pip/Main.vala"
	gala_plugins_pip_selection_area_start_selection (_tmp10_);
#line 469 "Main.c"
}

static void
gala_plugins_pip_plugin_on_selection_actor_selected (GalaPluginsPIPPlugin* self,
                                                     gint x,
                                                     gint y)
{
#line 70 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 71 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_clear_selection_area (self);
#line 72 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_select_window_at (self, x, y);
#line 483 "Main.c"
}

static void
_gala_plugins_pip_plugin_on_popup_window_show_clutter_actor_show (ClutterActor* _sender,
                                                                  gpointer self)
{
#line 97 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_on_popup_window_show ((GalaPluginsPIPPlugin*) self, _sender);
#line 492 "Main.c"
}

static void
_gala_plugins_pip_plugin_on_popup_window_hide_clutter_actor_hide (ClutterActor* _sender,
                                                                  gpointer self)
{
#line 98 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_on_popup_window_hide ((GalaPluginsPIPPlugin*) self, _sender);
#line 501 "Main.c"
}

static void
_vala_graphene_rect_t_free (graphene_rect_t* self)
{
#line 82 "../plugins/pip/Main.vala"
	g_boxed_free (graphene_rect_get_type (), self);
#line 509 "Main.c"
}

static void
gala_plugins_pip_plugin_on_selection_actor_captured (GalaPluginsPIPPlugin* self,
                                                     gint x,
                                                     gint y,
                                                     gint width,
                                                     gint height)
{
	gboolean _tmp0_ = FALSE;
#line 75 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 76 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_clear_selection_area (self);
#line 78 "../plugins/pip/Main.vala"
	if (width < GALA_PLUGINS_PIP_PLUGIN_MIN_SELECTION_SIZE) {
#line 78 "../plugins/pip/Main.vala"
		_tmp0_ = TRUE;
#line 528 "Main.c"
	} else {
#line 78 "../plugins/pip/Main.vala"
		_tmp0_ = height < GALA_PLUGINS_PIP_PLUGIN_MIN_SELECTION_SIZE;
#line 532 "Main.c"
	}
#line 78 "../plugins/pip/Main.vala"
	if (_tmp0_) {
#line 79 "../plugins/pip/Main.vala"
		gala_plugins_pip_plugin_select_window_at (self, x, y);
#line 538 "Main.c"
	} else {
		MetaWindowActor* active = NULL;
		MetaWindowActor* _tmp1_;
		MetaWindowActor* _tmp2_;
#line 81 "../plugins/pip/Main.vala"
		_tmp1_ = gala_plugins_pip_plugin_get_active_window_actor (self);
#line 81 "../plugins/pip/Main.vala"
		active = _tmp1_;
#line 82 "../plugins/pip/Main.vala"
		_tmp2_ = active;
#line 82 "../plugins/pip/Main.vala"
		if (_tmp2_ != NULL) {
#line 551 "Main.c"
			gint point_x = 0;
			MetaWindowActor* _tmp3_;
			gfloat _tmp4_;
			gfloat _tmp5_;
			gint point_y = 0;
			MetaWindowActor* _tmp6_;
			gfloat _tmp7_;
			gfloat _tmp8_;
			MtkRectangle input_rect = {0};
			MetaWindowActor* _tmp9_;
			MetaWindow* _tmp10_;
			MtkRectangle _tmp11_ = {0};
			MtkRectangle outer_rect = {0};
			MetaWindowActor* _tmp12_;
			MetaWindow* _tmp13_;
			MtkRectangle _tmp14_ = {0};
			MtkRectangle _tmp15_;
			MtkRectangle _tmp16_;
			MtkRectangle _tmp17_;
			MtkRectangle _tmp18_;
			graphene_rect_t* rect = NULL;
			graphene_rect_t* _tmp19_;
			graphene_rect_t* _tmp20_;
			GalaPluginsPIPPopupWindow* popup_window = NULL;
			GalaWindowManager* _tmp21_;
			MetaWindowActor* _tmp22_;
			GalaPluginsPIPPopupWindow* _tmp23_;
			GalaPluginsPIPPopupWindow* _tmp24_;
			graphene_rect_t* _tmp25_;
			GalaPluginsPIPPopupWindow* _tmp26_;
			GalaPluginsPIPPopupWindow* _tmp27_;
			GalaPluginsPIPPopupWindow* _tmp28_;
#line 83 "../plugins/pip/Main.vala"
			_tmp3_ = active;
#line 83 "../plugins/pip/Main.vala"
			_tmp4_ = clutter_actor_get_x ((ClutterActor*) _tmp3_);
#line 83 "../plugins/pip/Main.vala"
			_tmp5_ = _tmp4_;
#line 83 "../plugins/pip/Main.vala"
			point_x = x - ((gint) _tmp5_);
#line 84 "../plugins/pip/Main.vala"
			_tmp6_ = active;
#line 84 "../plugins/pip/Main.vala"
			_tmp7_ = clutter_actor_get_y ((ClutterActor*) _tmp6_);
#line 84 "../plugins/pip/Main.vala"
			_tmp8_ = _tmp7_;
#line 84 "../plugins/pip/Main.vala"
			point_y = y - ((gint) _tmp8_);
#line 87 "../plugins/pip/Main.vala"
			_tmp9_ = active;
#line 87 "../plugins/pip/Main.vala"
			_tmp10_ = meta_window_actor_get_meta_window (_tmp9_);
#line 87 "../plugins/pip/Main.vala"
			meta_window_get_buffer_rect (_tmp10_, &_tmp11_);
#line 87 "../plugins/pip/Main.vala"
			input_rect = _tmp11_;
#line 88 "../plugins/pip/Main.vala"
			_tmp12_ = active;
#line 88 "../plugins/pip/Main.vala"
			_tmp13_ = meta_window_actor_get_meta_window (_tmp12_);
#line 88 "../plugins/pip/Main.vala"
			meta_window_get_frame_rect (_tmp13_, &_tmp14_);
#line 88 "../plugins/pip/Main.vala"
			outer_rect = _tmp14_;
#line 89 "../plugins/pip/Main.vala"
			_tmp15_ = outer_rect;
#line 89 "../plugins/pip/Main.vala"
			_tmp16_ = input_rect;
#line 89 "../plugins/pip/Main.vala"
			point_x -= _tmp15_.x - _tmp16_.x;
#line 90 "../plugins/pip/Main.vala"
			_tmp17_ = outer_rect;
#line 90 "../plugins/pip/Main.vala"
			_tmp18_ = input_rect;
#line 90 "../plugins/pip/Main.vala"
			point_y -= _tmp17_.y - _tmp18_.y;
#line 92 "../plugins/pip/Main.vala"
			_tmp19_ = graphene_rect_alloc ();
#line 92 "../plugins/pip/Main.vala"
			rect = _tmp19_;
#line 93 "../plugins/pip/Main.vala"
			_tmp20_ = rect;
#line 93 "../plugins/pip/Main.vala"
			graphene_rect_init (_tmp20_, (gfloat) point_x, (gfloat) point_y, (gfloat) width, (gfloat) height);
#line 95 "../plugins/pip/Main.vala"
			_tmp21_ = self->priv->wm;
#line 95 "../plugins/pip/Main.vala"
			_tmp22_ = active;
#line 95 "../plugins/pip/Main.vala"
			_tmp23_ = gala_plugins_pip_popup_window_new (_tmp21_, _tmp22_);
#line 95 "../plugins/pip/Main.vala"
			g_object_ref_sink (_tmp23_);
#line 95 "../plugins/pip/Main.vala"
			popup_window = _tmp23_;
#line 96 "../plugins/pip/Main.vala"
			_tmp24_ = popup_window;
#line 96 "../plugins/pip/Main.vala"
			_tmp25_ = rect;
#line 96 "../plugins/pip/Main.vala"
			gala_plugins_pip_popup_window_set_container_clip (_tmp24_, _tmp25_);
#line 97 "../plugins/pip/Main.vala"
			_tmp26_ = popup_window;
#line 97 "../plugins/pip/Main.vala"
			g_signal_connect_object ((ClutterActor*) _tmp26_, "show", (GCallback) _gala_plugins_pip_plugin_on_popup_window_show_clutter_actor_show, self, 0);
#line 98 "../plugins/pip/Main.vala"
			_tmp27_ = popup_window;
#line 98 "../plugins/pip/Main.vala"
			g_signal_connect_object ((ClutterActor*) _tmp27_, "hide", (GCallback) _gala_plugins_pip_plugin_on_popup_window_hide_clutter_actor_hide, self, 0);
#line 99 "../plugins/pip/Main.vala"
			_tmp28_ = popup_window;
#line 99 "../plugins/pip/Main.vala"
			gala_plugins_pip_plugin_add_window (self, _tmp28_);
#line 82 "../plugins/pip/Main.vala"
			_g_object_unref0 (popup_window);
#line 82 "../plugins/pip/Main.vala"
			__vala_graphene_rect_t_free0 (rect);
#line 668 "Main.c"
		}
#line 78 "../plugins/pip/Main.vala"
		_g_object_unref0 (active);
#line 672 "Main.c"
	}
}

static void
gala_plugins_pip_plugin_on_popup_window_show (GalaPluginsPIPPlugin* self,
                                              ClutterActor* popup_window)
{
#line 104 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 104 "../plugins/pip/Main.vala"
	g_return_if_fail (popup_window != NULL);
#line 105 "../plugins/pip/Main.vala"
	gala_plugin_track_actor ((GalaPlugin*) self, popup_window);
#line 106 "../plugins/pip/Main.vala"
	gala_plugin_update_region ((GalaPlugin*) self);
#line 688 "Main.c"
}

static void
gala_plugins_pip_plugin_on_popup_window_hide (GalaPluginsPIPPlugin* self,
                                              ClutterActor* popup_window)
{
#line 109 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 109 "../plugins/pip/Main.vala"
	g_return_if_fail (popup_window != NULL);
#line 110 "../plugins/pip/Main.vala"
	gala_plugin_untrack_actor ((GalaPlugin*) self, popup_window);
#line 111 "../plugins/pip/Main.vala"
	gala_plugin_update_region ((GalaPlugin*) self);
#line 703 "Main.c"
}

static void
gala_plugins_pip_plugin_select_window_at (GalaPluginsPIPPlugin* self,
                                          gint x,
                                          gint y)
{
	MetaWindowActor* selected = NULL;
	MetaWindowActor* _tmp0_;
	MetaWindowActor* _tmp1_;
#line 114 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 115 "../plugins/pip/Main.vala"
	_tmp0_ = gala_plugins_pip_plugin_get_window_actor_at (self, x, y);
#line 115 "../plugins/pip/Main.vala"
	selected = _tmp0_;
#line 116 "../plugins/pip/Main.vala"
	_tmp1_ = selected;
#line 116 "../plugins/pip/Main.vala"
	if (_tmp1_ != NULL) {
#line 724 "Main.c"
		GalaPluginsPIPPopupWindow* popup_window = NULL;
		GalaWindowManager* _tmp2_;
		MetaWindowActor* _tmp3_;
		GalaPluginsPIPPopupWindow* _tmp4_;
		GalaPluginsPIPPopupWindow* _tmp5_;
		GalaPluginsPIPPopupWindow* _tmp6_;
		GalaPluginsPIPPopupWindow* _tmp7_;
#line 117 "../plugins/pip/Main.vala"
		_tmp2_ = self->priv->wm;
#line 117 "../plugins/pip/Main.vala"
		_tmp3_ = selected;
#line 117 "../plugins/pip/Main.vala"
		_tmp4_ = gala_plugins_pip_popup_window_new (_tmp2_, _tmp3_);
#line 117 "../plugins/pip/Main.vala"
		g_object_ref_sink (_tmp4_);
#line 117 "../plugins/pip/Main.vala"
		popup_window = _tmp4_;
#line 118 "../plugins/pip/Main.vala"
		_tmp5_ = popup_window;
#line 118 "../plugins/pip/Main.vala"
		g_signal_connect_object ((ClutterActor*) _tmp5_, "show", (GCallback) _gala_plugins_pip_plugin_on_popup_window_show_clutter_actor_show, self, 0);
#line 119 "../plugins/pip/Main.vala"
		_tmp6_ = popup_window;
#line 119 "../plugins/pip/Main.vala"
		g_signal_connect_object ((ClutterActor*) _tmp6_, "hide", (GCallback) _gala_plugins_pip_plugin_on_popup_window_hide_clutter_actor_hide, self, 0);
#line 120 "../plugins/pip/Main.vala"
		_tmp7_ = popup_window;
#line 120 "../plugins/pip/Main.vala"
		gala_plugins_pip_plugin_add_window (self, _tmp7_);
#line 116 "../plugins/pip/Main.vala"
		_g_object_unref0 (popup_window);
#line 756 "Main.c"
	}
#line 114 "../plugins/pip/Main.vala"
	_g_object_unref0 (selected);
#line 760 "Main.c"
}

static void
gala_plugins_pip_plugin_clear_selection_area (GalaPluginsPIPPlugin* self)
{
	GalaPluginsPIPSelectionArea* _tmp0_;
#line 124 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 125 "../plugins/pip/Main.vala"
	_tmp0_ = self->priv->selection_area;
#line 125 "../plugins/pip/Main.vala"
	if (_tmp0_ != NULL) {
#line 773 "Main.c"
		GalaPluginsPIPSelectionArea* _tmp1_;
		GalaPluginsPIPSelectionArea* _tmp2_;
#line 126 "../plugins/pip/Main.vala"
		_tmp1_ = self->priv->selection_area;
#line 126 "../plugins/pip/Main.vala"
		gala_plugin_untrack_actor ((GalaPlugin*) self, (ClutterActor*) _tmp1_);
#line 127 "../plugins/pip/Main.vala"
		gala_plugin_update_region ((GalaPlugin*) self);
#line 129 "../plugins/pip/Main.vala"
		_tmp2_ = self->priv->selection_area;
#line 129 "../plugins/pip/Main.vala"
		clutter_actor_destroy ((ClutterActor*) _tmp2_);
#line 130 "../plugins/pip/Main.vala"
		_g_object_unref0 (self->priv->selection_area);
#line 130 "../plugins/pip/Main.vala"
		self->priv->selection_area = NULL;
#line 790 "Main.c"
	}
}

static Block1Data*
block1_data_ref (Block1Data* _data1_)
{
#line 134 "../plugins/pip/Main.vala"
	g_atomic_int_inc (&_data1_->_ref_count_);
#line 134 "../plugins/pip/Main.vala"
	return _data1_;
#line 801 "Main.c"
}

static void
block1_data_unref (void * _userdata_)
{
	Block1Data* _data1_;
	_data1_ = (Block1Data*) _userdata_;
#line 134 "../plugins/pip/Main.vala"
	if (g_atomic_int_dec_and_test (&_data1_->_ref_count_)) {
#line 811 "Main.c"
		GalaPluginsPIPPlugin* self;
#line 134 "../plugins/pip/Main.vala"
		self = _data1_->self;
#line 134 "../plugins/pip/Main.vala"
		_g_object_unref0 (self);
#line 134 "../plugins/pip/Main.vala"
		g_slice_free (Block1Data, _data1_);
#line 819 "Main.c"
	}
}

static void
__lambda6_ (Block1Data* _data1_,
            MetaWindowActor* actor)
{
	GalaPluginsPIPPlugin* self;
	MetaWindow* window = NULL;
	MetaWindow* _tmp0_;
	MetaWindow* _tmp1_;
	MtkRectangle rect = {0};
	MetaWindow* _tmp2_;
	MtkRectangle _tmp3_ = {0};
	gboolean _tmp4_ = FALSE;
	gboolean _tmp5_ = FALSE;
	gboolean _tmp6_ = FALSE;
#line 142 "../plugins/pip/Main.vala"
	self = _data1_->self;
#line 142 "../plugins/pip/Main.vala"
	g_return_if_fail (actor != NULL);
#line 143 "../plugins/pip/Main.vala"
	if (_data1_->selected != NULL) {
#line 144 "../plugins/pip/Main.vala"
		return;
#line 845 "Main.c"
	}
#line 147 "../plugins/pip/Main.vala"
	_tmp0_ = meta_window_actor_get_meta_window (actor);
#line 147 "../plugins/pip/Main.vala"
	_tmp1_ = _g_object_ref0 (_tmp0_);
#line 147 "../plugins/pip/Main.vala"
	window = _tmp1_;
#line 148 "../plugins/pip/Main.vala"
	_tmp2_ = window;
#line 148 "../plugins/pip/Main.vala"
	meta_window_get_frame_rect (_tmp2_, &_tmp3_);
#line 148 "../plugins/pip/Main.vala"
	rect = _tmp3_;
#line 150 "../plugins/pip/Main.vala"
	if (!meta_window_actor_is_destroyed (actor)) {
#line 861 "Main.c"
		MetaWindow* _tmp7_;
#line 150 "../plugins/pip/Main.vala"
		_tmp7_ = window;
#line 150 "../plugins/pip/Main.vala"
		_tmp6_ = !meta_window_is_hidden (_tmp7_);
#line 867 "Main.c"
	} else {
#line 150 "../plugins/pip/Main.vala"
		_tmp6_ = FALSE;
#line 871 "Main.c"
	}
#line 150 "../plugins/pip/Main.vala"
	if (_tmp6_) {
#line 875 "Main.c"
		MetaWindow* _tmp8_;
#line 150 "../plugins/pip/Main.vala"
		_tmp8_ = window;
#line 150 "../plugins/pip/Main.vala"
		_tmp5_ = !meta_window_is_skip_taskbar (_tmp8_);
#line 881 "Main.c"
	} else {
#line 150 "../plugins/pip/Main.vala"
		_tmp5_ = FALSE;
#line 885 "Main.c"
	}
#line 150 "../plugins/pip/Main.vala"
	if (_tmp5_) {
#line 889 "Main.c"
		MtkRectangle _tmp9_;
#line 150 "../plugins/pip/Main.vala"
		_tmp9_ = rect;
#line 150 "../plugins/pip/Main.vala"
		_tmp4_ = gala_plugins_pip_plugin_meta_rectangle_contains (&_tmp9_, _data1_->x, _data1_->y);
#line 895 "Main.c"
	} else {
#line 150 "../plugins/pip/Main.vala"
		_tmp4_ = FALSE;
#line 899 "Main.c"
	}
#line 150 "../plugins/pip/Main.vala"
	if (_tmp4_) {
#line 151 "../plugins/pip/Main.vala"
		_data1_->selected = actor;
#line 905 "Main.c"
	}
#line 142 "../plugins/pip/Main.vala"
	_g_object_unref0 (window);
#line 909 "Main.c"
}

static void
___lambda6__gfunc (gconstpointer data,
                   gpointer self)
{
#line 142 "../plugins/pip/Main.vala"
	__lambda6_ (self, (MetaWindowActor*) data);
#line 918 "Main.c"
}

static MetaWindowActor*
gala_plugins_pip_plugin_get_window_actor_at (GalaPluginsPIPPlugin* self,
                                             gint x,
                                             gint y)
{
	Block1Data* _data1_;
	MetaDisplay* display = NULL;
	GalaWindowManager* _tmp0_;
	MetaDisplay* _tmp1_;
	GList* actors = NULL;
	GList* _tmp2_;
	GList* copy = NULL;
	GList* _tmp3_;
	MetaWindowActor* _tmp4_;
	MetaWindowActor* result;
#line 134 "../plugins/pip/Main.vala"
	g_return_val_if_fail (self != NULL, NULL);
#line 134 "../plugins/pip/Main.vala"
	_data1_ = g_slice_new0 (Block1Data);
#line 134 "../plugins/pip/Main.vala"
	_data1_->_ref_count_ = 1;
#line 134 "../plugins/pip/Main.vala"
	_data1_->self = g_object_ref (self);
#line 134 "../plugins/pip/Main.vala"
	_data1_->x = x;
#line 134 "../plugins/pip/Main.vala"
	_data1_->y = y;
#line 135 "../plugins/pip/Main.vala"
	_tmp0_ = self->priv->wm;
#line 135 "../plugins/pip/Main.vala"
	_tmp1_ = meta_plugin_get_display ((MetaPlugin*) _tmp0_);
#line 135 "../plugins/pip/Main.vala"
	display = _tmp1_;
#line 136 "../plugins/pip/Main.vala"
	_tmp2_ = meta_get_window_actors (display);
#line 136 "../plugins/pip/Main.vala"
	actors = _tmp2_;
#line 138 "../plugins/pip/Main.vala"
	_tmp3_ = g_list_copy (actors);
#line 138 "../plugins/pip/Main.vala"
	copy = _tmp3_;
#line 139 "../plugins/pip/Main.vala"
	copy = g_list_reverse (copy);
#line 141 "../plugins/pip/Main.vala"
	_data1_->selected = NULL;
#line 142 "../plugins/pip/Main.vala"
	g_list_foreach (copy, ___lambda6__gfunc, _data1_);
#line 155 "../plugins/pip/Main.vala"
	_tmp4_ = _g_object_ref0 (_data1_->selected);
#line 155 "../plugins/pip/Main.vala"
	result = _tmp4_;
#line 155 "../plugins/pip/Main.vala"
	(copy == NULL) ? NULL : (copy = (g_list_free (copy), NULL));
#line 155 "../plugins/pip/Main.vala"
	block1_data_unref (_data1_);
#line 155 "../plugins/pip/Main.vala"
	_data1_ = NULL;
#line 155 "../plugins/pip/Main.vala"
	return result;
#line 980 "Main.c"
}

static Block2Data*
block2_data_ref (Block2Data* _data2_)
{
#line 158 "../plugins/pip/Main.vala"
	g_atomic_int_inc (&_data2_->_ref_count_);
#line 158 "../plugins/pip/Main.vala"
	return _data2_;
#line 990 "Main.c"
}

static void
block2_data_unref (void * _userdata_)
{
	Block2Data* _data2_;
	_data2_ = (Block2Data*) _userdata_;
#line 158 "../plugins/pip/Main.vala"
	if (g_atomic_int_dec_and_test (&_data2_->_ref_count_)) {
#line 1000 "Main.c"
		GalaPluginsPIPPlugin* self;
#line 158 "../plugins/pip/Main.vala"
		self = _data2_->self;
#line 158 "../plugins/pip/Main.vala"
		_g_object_unref0 (self);
#line 158 "../plugins/pip/Main.vala"
		g_slice_free (Block2Data, _data2_);
#line 1008 "Main.c"
	}
}

static void
__lambda8_ (Block2Data* _data2_,
            MetaWindowActor* actor)
{
	GalaPluginsPIPPlugin* self;
	MetaWindow* window = NULL;
	MetaWindow* _tmp0_;
	MetaWindow* _tmp1_;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	gboolean _tmp4_ = FALSE;
#line 166 "../plugins/pip/Main.vala"
	self = _data2_->self;
#line 166 "../plugins/pip/Main.vala"
	g_return_if_fail (actor != NULL);
#line 167 "../plugins/pip/Main.vala"
	if (_data2_->active != NULL) {
#line 168 "../plugins/pip/Main.vala"
		return;
#line 1031 "Main.c"
	}
#line 171 "../plugins/pip/Main.vala"
	_tmp0_ = meta_window_actor_get_meta_window (actor);
#line 171 "../plugins/pip/Main.vala"
	_tmp1_ = _g_object_ref0 (_tmp0_);
#line 171 "../plugins/pip/Main.vala"
	window = _tmp1_;
#line 172 "../plugins/pip/Main.vala"
	if (!meta_window_actor_is_destroyed (actor)) {
#line 1041 "Main.c"
		MetaWindow* _tmp5_;
#line 172 "../plugins/pip/Main.vala"
		_tmp5_ = window;
#line 172 "../plugins/pip/Main.vala"
		_tmp4_ = !meta_window_is_hidden (_tmp5_);
#line 1047 "Main.c"
	} else {
#line 172 "../plugins/pip/Main.vala"
		_tmp4_ = FALSE;
#line 1051 "Main.c"
	}
#line 172 "../plugins/pip/Main.vala"
	if (_tmp4_) {
#line 1055 "Main.c"
		MetaWindow* _tmp6_;
#line 172 "../plugins/pip/Main.vala"
		_tmp6_ = window;
#line 172 "../plugins/pip/Main.vala"
		_tmp3_ = !meta_window_is_skip_taskbar (_tmp6_);
#line 1061 "Main.c"
	} else {
#line 172 "../plugins/pip/Main.vala"
		_tmp3_ = FALSE;
#line 1065 "Main.c"
	}
#line 172 "../plugins/pip/Main.vala"
	if (_tmp3_) {
#line 1069 "Main.c"
		MetaWindow* _tmp7_;
#line 172 "../plugins/pip/Main.vala"
		_tmp7_ = window;
#line 172 "../plugins/pip/Main.vala"
		_tmp2_ = meta_window_has_focus (_tmp7_);
#line 1075 "Main.c"
	} else {
#line 172 "../plugins/pip/Main.vala"
		_tmp2_ = FALSE;
#line 1079 "Main.c"
	}
#line 172 "../plugins/pip/Main.vala"
	if (_tmp2_) {
#line 173 "../plugins/pip/Main.vala"
		_data2_->active = actor;
#line 1085 "Main.c"
	}
#line 166 "../plugins/pip/Main.vala"
	_g_object_unref0 (window);
#line 1089 "Main.c"
}

static void
___lambda8__gfunc (gconstpointer data,
                   gpointer self)
{
#line 166 "../plugins/pip/Main.vala"
	__lambda8_ (self, (MetaWindowActor*) data);
#line 1098 "Main.c"
}

static MetaWindowActor*
gala_plugins_pip_plugin_get_active_window_actor (GalaPluginsPIPPlugin* self)
{
	Block2Data* _data2_;
	MetaDisplay* display = NULL;
	GalaWindowManager* _tmp0_;
	MetaDisplay* _tmp1_;
	GList* actors = NULL;
	GList* _tmp2_;
	GList* copy = NULL;
	GList* _tmp3_;
	MetaWindowActor* _tmp4_;
	MetaWindowActor* result;
#line 158 "../plugins/pip/Main.vala"
	g_return_val_if_fail (self != NULL, NULL);
#line 158 "../plugins/pip/Main.vala"
	_data2_ = g_slice_new0 (Block2Data);
#line 158 "../plugins/pip/Main.vala"
	_data2_->_ref_count_ = 1;
#line 158 "../plugins/pip/Main.vala"
	_data2_->self = g_object_ref (self);
#line 159 "../plugins/pip/Main.vala"
	_tmp0_ = self->priv->wm;
#line 159 "../plugins/pip/Main.vala"
	_tmp1_ = meta_plugin_get_display ((MetaPlugin*) _tmp0_);
#line 159 "../plugins/pip/Main.vala"
	display = _tmp1_;
#line 160 "../plugins/pip/Main.vala"
	_tmp2_ = meta_get_window_actors (display);
#line 160 "../plugins/pip/Main.vala"
	actors = _tmp2_;
#line 162 "../plugins/pip/Main.vala"
	_tmp3_ = g_list_copy (actors);
#line 162 "../plugins/pip/Main.vala"
	copy = _tmp3_;
#line 163 "../plugins/pip/Main.vala"
	copy = g_list_reverse (copy);
#line 165 "../plugins/pip/Main.vala"
	_data2_->active = NULL;
#line 166 "../plugins/pip/Main.vala"
	g_list_foreach (actors, ___lambda8__gfunc, _data2_);
#line 177 "../plugins/pip/Main.vala"
	_tmp4_ = _g_object_ref0 (_data2_->active);
#line 177 "../plugins/pip/Main.vala"
	result = _tmp4_;
#line 177 "../plugins/pip/Main.vala"
	(copy == NULL) ? NULL : (copy = (g_list_free (copy), NULL));
#line 177 "../plugins/pip/Main.vala"
	block2_data_unref (_data2_);
#line 177 "../plugins/pip/Main.vala"
	_data2_ = NULL;
#line 177 "../plugins/pip/Main.vala"
	return result;
#line 1154 "Main.c"
}

static Block3Data*
block3_data_ref (Block3Data* _data3_)
{
#line 180 "../plugins/pip/Main.vala"
	g_atomic_int_inc (&_data3_->_ref_count_);
#line 180 "../plugins/pip/Main.vala"
	return _data3_;
#line 1164 "Main.c"
}

static void
block3_data_unref (void * _userdata_)
{
	Block3Data* _data3_;
	_data3_ = (Block3Data*) _userdata_;
#line 180 "../plugins/pip/Main.vala"
	if (g_atomic_int_dec_and_test (&_data3_->_ref_count_)) {
#line 1174 "Main.c"
		GalaPluginsPIPPlugin* self;
#line 180 "../plugins/pip/Main.vala"
		self = _data3_->self;
#line 180 "../plugins/pip/Main.vala"
		_g_object_unref0 (_data3_->popup_window);
#line 180 "../plugins/pip/Main.vala"
		_g_object_unref0 (self);
#line 180 "../plugins/pip/Main.vala"
		g_slice_free (Block3Data, _data3_);
#line 1184 "Main.c"
	}
}

static void
__lambda7_ (Block3Data* _data3_)
{
	GalaPluginsPIPPlugin* self;
#line 181 "../plugins/pip/Main.vala"
	self = _data3_->self;
#line 181 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_remove_window (self, _data3_->popup_window);
#line 1196 "Main.c"
}

static void
___lambda7__gala_plugins_pip_popup_window_closed (GalaPluginsPIPPopupWindow* _sender,
                                                  gpointer self)
{
#line 181 "../plugins/pip/Main.vala"
	__lambda7_ (self);
#line 1205 "Main.c"
}

static void
gala_plugins_pip_plugin_add_window (GalaPluginsPIPPlugin* self,
                                    GalaPluginsPIPPopupWindow* popup_window)
{
	Block3Data* _data3_;
	GalaPluginsPIPPopupWindow* _tmp0_;
	GeeArrayList* _tmp1_;
	GalaWindowManager* _tmp2_;
	ClutterActor* _tmp3_;
	ClutterActor* _tmp4_;
#line 180 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 180 "../plugins/pip/Main.vala"
	g_return_if_fail (popup_window != NULL);
#line 180 "../plugins/pip/Main.vala"
	_data3_ = g_slice_new0 (Block3Data);
#line 180 "../plugins/pip/Main.vala"
	_data3_->_ref_count_ = 1;
#line 180 "../plugins/pip/Main.vala"
	_data3_->self = g_object_ref (self);
#line 180 "../plugins/pip/Main.vala"
	_tmp0_ = _g_object_ref0 (popup_window);
#line 180 "../plugins/pip/Main.vala"
	_g_object_unref0 (_data3_->popup_window);
#line 180 "../plugins/pip/Main.vala"
	_data3_->popup_window = _tmp0_;
#line 181 "../plugins/pip/Main.vala"
	g_signal_connect_data (_data3_->popup_window, "closed", (GCallback) ___lambda7__gala_plugins_pip_popup_window_closed, block3_data_ref (_data3_), (GClosureNotify) block3_data_unref, 0);
#line 182 "../plugins/pip/Main.vala"
	_tmp1_ = self->priv->windows;
#line 182 "../plugins/pip/Main.vala"
	gee_abstract_collection_add ((GeeAbstractCollection*) _tmp1_, _data3_->popup_window);
#line 183 "../plugins/pip/Main.vala"
	_tmp2_ = self->priv->wm;
#line 183 "../plugins/pip/Main.vala"
	_tmp3_ = gala_window_manager_get_ui_group (_tmp2_);
#line 183 "../plugins/pip/Main.vala"
	_tmp4_ = _tmp3_;
#line 183 "../plugins/pip/Main.vala"
	clutter_actor_add_child (_tmp4_, (ClutterActor*) _data3_->popup_window);
#line 180 "../plugins/pip/Main.vala"
	block3_data_unref (_data3_);
#line 180 "../plugins/pip/Main.vala"
	_data3_ = NULL;
#line 1252 "Main.c"
}

static void
gala_plugins_pip_plugin_remove_window (GalaPluginsPIPPlugin* self,
                                       GalaPluginsPIPPopupWindow* popup_window)
{
	GeeArrayList* _tmp0_;
#line 186 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 186 "../plugins/pip/Main.vala"
	g_return_if_fail (popup_window != NULL);
#line 187 "../plugins/pip/Main.vala"
	_tmp0_ = self->priv->windows;
#line 187 "../plugins/pip/Main.vala"
	gee_abstract_collection_remove ((GeeAbstractCollection*) _tmp0_, popup_window);
#line 188 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_untrack_window (self, popup_window);
#line 1270 "Main.c"
}

static void
gala_plugins_pip_plugin_untrack_window (GalaPluginsPIPPlugin* self,
                                        GalaPluginsPIPPopupWindow* popup_window)
{
#line 191 "../plugins/pip/Main.vala"
	g_return_if_fail (self != NULL);
#line 191 "../plugins/pip/Main.vala"
	g_return_if_fail (popup_window != NULL);
#line 192 "../plugins/pip/Main.vala"
	gala_plugin_untrack_actor ((GalaPlugin*) self, (ClutterActor*) popup_window);
#line 193 "../plugins/pip/Main.vala"
	gala_plugin_update_region ((GalaPlugin*) self);
#line 194 "../plugins/pip/Main.vala"
	clutter_actor_destroy ((ClutterActor*) popup_window);
#line 1287 "Main.c"
}

GalaPluginsPIPPlugin*
gala_plugins_pip_plugin_construct (GType object_type)
{
	GalaPluginsPIPPlugin * self = NULL;
#line 18 "../plugins/pip/Main.vala"
	self = (GalaPluginsPIPPlugin*) gala_plugin_construct (object_type);
#line 18 "../plugins/pip/Main.vala"
	return self;
#line 1298 "Main.c"
}

GalaPluginsPIPPlugin*
gala_plugins_pip_plugin_new (void)
{
#line 18 "../plugins/pip/Main.vala"
	return gala_plugins_pip_plugin_construct (GALA_PLUGINS_PIP_TYPE_PLUGIN);
#line 1306 "Main.c"
}

static GObject *
gala_plugins_pip_plugin_constructor (GType type,
                                     guint n_construct_properties,
                                     GObjectConstructParam * construct_properties)
{
	GObject * obj;
	GObjectClass * parent_class;
	GalaPluginsPIPPlugin * self;
	GeeArrayList* _tmp0_;
#line 34 "../plugins/pip/Main.vala"
	parent_class = G_OBJECT_CLASS (gala_plugins_pip_plugin_parent_class);
#line 34 "../plugins/pip/Main.vala"
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
#line 34 "../plugins/pip/Main.vala"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, GALA_PLUGINS_PIP_TYPE_PLUGIN, GalaPluginsPIPPlugin);
#line 35 "../plugins/pip/Main.vala"
	_tmp0_ = gee_array_list_new (GALA_PLUGINS_PIP_TYPE_POPUP_WINDOW, (GBoxedCopyFunc) g_object_ref, (GDestroyNotify) g_object_unref, NULL, NULL, NULL);
#line 35 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->windows);
#line 35 "../plugins/pip/Main.vala"
	self->priv->windows = _tmp0_;
#line 34 "../plugins/pip/Main.vala"
	return obj;
#line 1332 "Main.c"
}

static void
gala_plugins_pip_plugin_class_init (GalaPluginsPIPPluginClass * klass,
                                    gpointer klass_data)
{
#line 18 "../plugins/pip/Main.vala"
	gala_plugins_pip_plugin_parent_class = g_type_class_peek_parent (klass);
#line 18 "../plugins/pip/Main.vala"
	g_type_class_adjust_private_offset (klass, &GalaPluginsPIPPlugin_private_offset);
#line 18 "../plugins/pip/Main.vala"
	((GalaPluginClass *) klass)->initialize = (void (*) (GalaPlugin*, GalaWindowManager*)) gala_plugins_pip_plugin_real_initialize;
#line 18 "../plugins/pip/Main.vala"
	((GalaPluginClass *) klass)->destroy = (void (*) (GalaPlugin*)) gala_plugins_pip_plugin_real_destroy;
#line 18 "../plugins/pip/Main.vala"
	G_OBJECT_CLASS (klass)->constructor = gala_plugins_pip_plugin_constructor;
#line 18 "../plugins/pip/Main.vala"
	G_OBJECT_CLASS (klass)->finalize = gala_plugins_pip_plugin_finalize;
#line 1351 "Main.c"
}

static void
gala_plugins_pip_plugin_instance_init (GalaPluginsPIPPlugin * self,
                                       gpointer klass)
{
#line 18 "../plugins/pip/Main.vala"
	self->priv = gala_plugins_pip_plugin_get_instance_private (self);
#line 22 "../plugins/pip/Main.vala"
	self->priv->wm = NULL;
#line 1362 "Main.c"
}

static void
gala_plugins_pip_plugin_finalize (GObject * obj)
{
	GalaPluginsPIPPlugin * self;
#line 18 "../plugins/pip/Main.vala"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, GALA_PLUGINS_PIP_TYPE_PLUGIN, GalaPluginsPIPPlugin);
#line 21 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->windows);
#line 22 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->wm);
#line 23 "../plugins/pip/Main.vala"
	_g_object_unref0 (self->priv->selection_area);
#line 18 "../plugins/pip/Main.vala"
	G_OBJECT_CLASS (gala_plugins_pip_plugin_parent_class)->finalize (obj);
#line 1379 "Main.c"
}

 G_GNUC_NO_INLINE static GType
gala_plugins_pip_plugin_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (GalaPluginsPIPPluginClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) gala_plugins_pip_plugin_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (GalaPluginsPIPPlugin), 0, (GInstanceInitFunc) gala_plugins_pip_plugin_instance_init, NULL };
	GType gala_plugins_pip_plugin_type_id;
	gala_plugins_pip_plugin_type_id = g_type_register_static (GALA_TYPE_PLUGIN, "GalaPluginsPIPPlugin", &g_define_type_info, 0);
	GalaPluginsPIPPlugin_private_offset = g_type_add_instance_private (gala_plugins_pip_plugin_type_id, sizeof (GalaPluginsPIPPluginPrivate));
	return gala_plugins_pip_plugin_type_id;
}

GType
gala_plugins_pip_plugin_get_type (void)
{
	static gsize gala_plugins_pip_plugin_type_id__once = 0;
	if (g_once_init_enter (&gala_plugins_pip_plugin_type_id__once)) {
		GType gala_plugins_pip_plugin_type_id;
		gala_plugins_pip_plugin_type_id = gala_plugins_pip_plugin_get_type_once ();
		g_once_init_leave (&gala_plugins_pip_plugin_type_id__once, gala_plugins_pip_plugin_type_id);
	}
	return gala_plugins_pip_plugin_type_id__once;
}

void
register_plugin (GalaPluginInfo* result)
{
	gchar* _tmp0_;
	gchar* _tmp1_;
	GalaPluginInfo _tmp2_ = {0};
#line 199 "../plugins/pip/Main.vala"
	_tmp0_ = g_strdup ("Popup Window");
#line 199 "../plugins/pip/Main.vala"
	_tmp1_ = g_strdup ("Adam Bie≈Ñkowski <donadigos159@gmail.com>");
#line 199 "../plugins/pip/Main.vala"
	memset (&_tmp2_, 0, sizeof (GalaPluginInfo));
#line 199 "../plugins/pip/Main.vala"
	_g_free0 (_tmp2_.name);
#line 199 "../plugins/pip/Main.vala"
	_tmp2_.name = _tmp0_;
#line 199 "../plugins/pip/Main.vala"
	_g_free0 (_tmp2_.author);
#line 199 "../plugins/pip/Main.vala"
	_tmp2_.author = _tmp1_;
#line 199 "../plugins/pip/Main.vala"
	_tmp2_.plugin_type = GALA_PLUGINS_PIP_TYPE_PLUGIN;
#line 199 "../plugins/pip/Main.vala"
	_tmp2_.provides = GALA_PLUGIN_FUNCTION_ADDITION;
#line 199 "../plugins/pip/Main.vala"
	_tmp2_.load_priority = GALA_LOAD_PRIORITY_IMMEDIATE;
#line 199 "../plugins/pip/Main.vala"
	*result = _tmp2_;
#line 199 "../plugins/pip/Main.vala"
	return;
#line 1434 "Main.c"
}

